<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transportç®¡ç† - MCP-RS Web UI</title>
    <link rel="stylesheet" href="../shared/mcp-ui.css">
</head>
<body>
    <div class="mcp-container mcp-fade-in">
        <header class="mcp-header">
            <h1>ğŸŒ Transportç®¡ç†</h1>
            <p>å‹•çš„Transportåˆ‡ã‚Šæ›¿ãˆã¨ãƒ—ãƒ­ãƒˆã‚³ãƒ«ç®¡ç†</p>
        </header>

        <nav class="mcp-nav">
            <ul>
                <li><a href="../index.html" id="nav-home">ğŸ  ãƒ›ãƒ¼ãƒ </a></li>
                <li><a href="../wordpress/dashboard.html" id="nav-wordpress">ğŸ”— WordPressç®¡ç†</a></li>
                <li><a href="config.html" id="nav-config">âš™ï¸ ã‚µãƒ¼ãƒãƒ¼è¨­å®š</a></li>
                <li><a href="transport.html" id="nav-transport" class="active">ğŸŒ Transportç®¡ç†</a></li>
                <li><a href="logs.html" id="nav-logs">ğŸ“‹ ãƒ­ã‚°ç®¡ç†</a></li>
            </ul>
        </nav>

        <main class="mcp-main">
            <!-- ç¾åœ¨ã®TransportçŠ¶æ…‹ -->
            <div class="mcp-card">
                <h3>ğŸ“Š ç¾åœ¨ã®TransportçŠ¶æ…‹</h3>
                <div class="mcp-grid cols-3">
                    <div class="mcp-card">
                        <h4>ğŸ”Œ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–Transport</h4>
                        <div id="active-transport">
                            <span style="color: #28a745; font-size: 1.2em;">ğŸŒ HTTP</span>
                            <p style="margin: 5px 0 0 0; color: #6c757d;">Port: 8081</p>
                        </div>
                    </div>
                    <div class="mcp-card">
                        <h4>ğŸ“¡ æ¥ç¶šçŠ¶æ³</h4>
                        <div id="connection-stats">
                            <span style="color: #17a2b8;">âœ… æ¥ç¶šä¸­</span>
                            <p style="margin: 5px 0 0 0; color: #6c757d;">ç¨¼åƒæ™‚é–“: 2h 15m</p>
                        </div>
                    </div>
                    <div class="mcp-card">
                        <h4>ğŸ“ˆ çµ±è¨ˆæƒ…å ±</h4>
                        <div id="transport-stats">
                            <p>ãƒªã‚¯ã‚¨ã‚¹ãƒˆ: <strong>142</strong></p>
                            <p>ã‚¨ãƒ©ãƒ¼: <strong>0</strong></p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mcp-grid cols-2">
                <!-- Transportåˆ‡ã‚Šæ›¿ãˆãƒ‘ãƒãƒ« -->
                <div class="mcp-card">
                    <h3>ğŸ”„ Transportåˆ‡ã‚Šæ›¿ãˆ</h3>
                    
                    <div class="mb-2">
                        <h4>ğŸ“¡ STDIO Transport</h4>
                        <p style="color: #6c757d; margin-bottom: 15px;">
                            Claude Desktop, ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ç”¨ã®æ¨™æº–å…¥å‡ºåŠ›é€šä¿¡
                        </p>
                        <button class="mcp-btn primary full-width" id="switch-to-stdio">
                            ğŸ“¡ STDIOã«åˆ‡ã‚Šæ›¿ãˆ
                        </button>
                        <div class="mt-1 p-1" style="background: #fff3cd; border-radius: 6px;">
                            <small><strong>âš ï¸ æ³¨æ„:</strong> Web UIã¯ä½¿ç”¨ä¸å¯ã«ãªã‚Šã¾ã™</small>
                        </div>
                    </div>

                    <div class="mb-2">
                        <h4>ğŸŒ HTTP Transport</h4>
                        <p style="color: #6c757d; margin-bottom: 15px;">
                            Web UI, REST API, AI Agentç”¨ã®HTTP JSON-RPC
                        </p>
                        
                        <label for="http-port"><strong>HTTPãƒãƒ¼ãƒˆ</strong></label>
                        <input type="number" class="mcp-input" id="http-port" 
                               value="8081" min="1024" max="65535">
                        
                        <button class="mcp-btn primary full-width" id="switch-to-http">
                            ğŸŒ HTTPã«åˆ‡ã‚Šæ›¿ãˆ
                        </button>
                        <div class="mt-1 p-1" style="background: #e7f3ff; border-radius: 6px;">
                            <small><strong>ğŸ’¡ æ¨å¥¨:</strong> Web UIä½¿ç”¨æ™‚ã¯HTTPã‚’é¸æŠ</small>
                        </div>
                    </div>

                    <div class="mb-2">
                        <h4>ğŸ”Œ WebSocket Transport</h4>
                        <p style="color: #6c757d; margin-bottom: 15px;">
                            ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡ç”¨ã®WebSocketãƒ—ãƒ­ãƒˆã‚³ãƒ«
                        </p>
                        <button class="mcp-btn secondary full-width" disabled>
                            ğŸš§ WebSocket (é–‹ç™ºä¸­)
                        </button>
                        <div class="mt-1 p-1" style="background: #f8d7da; border-radius: 6px;">
                            <small><strong>ğŸš§ é–‹ç™ºä¸­:</strong> å°†æ¥ã®ãƒªãƒªãƒ¼ã‚¹ã§å®Ÿè£…äºˆå®š</small>
                        </div>
                    </div>
                </div>

                <!-- è¨­å®šãƒ»ç›£è¦–ãƒ‘ãƒãƒ« -->
                <div class="mcp-card">
                    <h3>âš™ï¸ Transportè¨­å®šãƒ»ç›£è¦–</h3>
                    
                    <div class="mb-2">
                        <h4>ğŸ”§ æ¥ç¶šè¨­å®š</h4>
                        <label for="max-connections"><strong>æœ€å¤§æ¥ç¶šæ•°</strong></label>
                        <input type="number" class="mcp-input" id="max-connections" 
                               value="100" min="1" max="1000">
                        
                        <label for="timeout-ms"><strong>ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ (ms)</strong></label>
                        <input type="number" class="mcp-input" id="timeout-ms" 
                               value="30000" min="1000" max="300000">
                        
                        <label>
                            <input type="checkbox" id="cors-enabled" checked>
                            <strong>CORSæœ‰åŠ¹åŒ–</strong>
                        </label>
                        
                        <button class="mcp-btn secondary full-width" id="apply-transport-config">
                            ğŸ’¾ Transportè¨­å®šã‚’é©ç”¨
                        </button>
                    </div>

                    <div class="mb-2">
                        <h4>ğŸ“Š ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–</h4>
                        <button class="mcp-btn secondary full-width" id="start-monitoring">
                            ğŸ“ˆ ç›£è¦–é–‹å§‹
                        </button>
                        <button class="mcp-btn warning full-width" id="reset-stats">
                            ğŸ”„ çµ±è¨ˆãƒªã‚»ãƒƒãƒˆ
                        </button>
                        <button class="mcp-btn danger full-width" id="force-disconnect">
                            âš ï¸ å¼·åˆ¶åˆ‡æ–­
                        </button>
                    </div>

                    <div class="mb-2">
                        <h4>ğŸ§ª æ¥ç¶šãƒ†ã‚¹ãƒˆ</h4>
                        <button class="mcp-btn primary full-width" id="test-current-transport">
                            ğŸ§ª ç¾åœ¨ã®Transportã‚’ãƒ†ã‚¹ãƒˆ
                        </button>
                        <button class="mcp-btn secondary full-width" id="benchmark-transport">
                            âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
                        </button>
                    </div>
                </div>
            </div>

            <!-- Transportè©³ç´°æƒ…å ± -->
            <div class="mcp-card">
                <h3>ğŸ“‹ Transportè©³ç´°æƒ…å ±</h3>
                
                <div class="mb-2">
                    <h4>ğŸ” ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ¥ç¶šä¸€è¦§</h4>
                    <div id="active-connections">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: #f8f9fa;">
                                    <th style="padding: 10px; border: 1px solid #dee2e6;">ID</th>
                                    <th style="padding: 10px; border: 1px solid #dee2e6;">ã‚¿ã‚¤ãƒ—</th>
                                    <th style="padding: 10px; border: 1px solid #dee2e6;">ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ</th>
                                    <th style="padding: 10px; border: 1px solid #dee2e6;">æ¥ç¶šæ™‚åˆ»</th>
                                    <th style="padding: 10px; border: 1px solid #dee2e6;">ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°</th>
                                    <th style="padding: 10px; border: 1px solid #dee2e6;">çŠ¶æ…‹</th>
                                </tr>
                            </thead>
                            <tbody id="connections-tbody">
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">#001</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">HTTP</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">Web UI</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">2025-11-09 14:30</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">87</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;"><span style="color: #28a745;">â—</span> ã‚¢ã‚¯ãƒ†ã‚£ãƒ–</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="mb-2">
                    <h4>ğŸ“ˆ Transportçµ±è¨ˆ</h4>
                    <div id="transport-statistics">
                        <div class="mcp-grid cols-3">
                            <div style="text-align: center; padding: 15px; background: #e7f3ff; border-radius: 8px;">
                                <h5>ç·ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°</h5>
                                <div style="font-size: 2em; color: #007bff;"><strong>1,247</strong></div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: #d4edda; border-radius: 8px;">
                                <h5>æˆåŠŸç‡</h5>
                                <div style="font-size: 2em; color: #28a745;"><strong>99.2%</strong></div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: #fff3cd; border-radius: 8px;">
                                <h5>å¹³å‡ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“</h5>
                                <div style="font-size: 2em; color: #ffc107;"><strong>145ms</strong></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ“ä½œå±¥æ­´ -->
            <div class="mcp-card">
                <h3>ğŸ“‹ Transportæ“ä½œå±¥æ­´</h3>
                <div id="transport-history">
                    <div class="text-center" style="color: #6c757d; padding: 20px;">
                        <p>Transportæ“ä½œå±¥æ­´ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
                    </div>
                </div>
            </div>
        </main>

        <footer class="mcp-footer">
            <p>
                ğŸš€ MCP-RS v0.15.1 - Transport Management Console | 
                ğŸ’» é–‹ç™ºè€…: <strong>n-takatsu</strong> | 
                ğŸŒ <a href="https://github.com/n-takatsu/mcp-rs">GitHub</a>
            </p>
        </footer>
    </div>

    <script src="../shared/mcp-ui.js"></script>
    <script>
        class TransportManager {
            constructor() {
                this.client = new MCPClient();
                this.configManager = new MCPConfigManager(this.client);
                this.currentTransport = 'http';
                this.operationHistory = [];
                this.monitoringInterval = null;
                
                this.initializeElements();
                this.bindEvents();
                this.startStatusMonitoring();
            }

            initializeElements() {
                // Transportåˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³
                this.switchStdioBtn = document.getElementById('switch-to-stdio');
                this.switchHttpBtn = document.getElementById('switch-to-http');
                this.httpPortInput = document.getElementById('http-port');

                // è¨­å®šè¦ç´ 
                this.maxConnectionsInput = document.getElementById('max-connections');
                this.timeoutInput = document.getElementById('timeout-ms');
                this.corsEnabledCheckbox = document.getElementById('cors-enabled');

                // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
                MCPUIComponents.setActiveNav('nav-transport');
            }

            bindEvents() {
                // Transportåˆ‡ã‚Šæ›¿ãˆ
                this.switchStdioBtn.addEventListener('click', () => this.switchToStdio());
                this.switchHttpBtn.addEventListener('click', () => this.switchToHttp());

                // è¨­å®šãƒ»ç›£è¦–
                document.getElementById('apply-transport-config').addEventListener('click', () => this.applyTransportConfig());
                document.getElementById('start-monitoring').addEventListener('click', () => this.toggleMonitoring());
                document.getElementById('reset-stats').addEventListener('click', () => this.resetStats());
                document.getElementById('force-disconnect').addEventListener('click', () => this.forceDisconnect());

                // ãƒ†ã‚¹ãƒˆ
                document.getElementById('test-current-transport').addEventListener('click', () => this.testCurrentTransport());
                document.getElementById('benchmark-transport').addEventListener('click', () => this.benchmarkTransport());
            }

            async switchToStdio() {
                MCPUIComponents.showModal(
                    'âš ï¸ STDIO Transportåˆ‡ã‚Šæ›¿ãˆç¢ºèª',
                    `<p><strong>æ³¨æ„:</strong> STDIOã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã¨ã€Web UIã§ã®æ“ä½œãŒã§ããªããªã‚Šã¾ã™ã€‚</p>
                     <p>Claude Desktopã‚„ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰ã®ä½¿ç”¨ã«ãªã‚Šã¾ã™ã€‚</p>
                     <p>æœ¬å½“ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã‹ï¼Ÿ</p>`,
                    [
                        { 
                            text: 'STDIOã«åˆ‡ã‚Šæ›¿ãˆ', 
                            type: 'warning',
                            onclick: 'this.closest(\'.modal\').remove(); window.transportManager.executeStdioSwitch();'
                        },
                        { text: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«', type: 'secondary' }
                    ]
                );
            }

            async executeStdioSwitch() {
                try {
                    this.addOperationHistory('Transportåˆ‡ã‚Šæ›¿ãˆ', 'STDIOã¸ã®åˆ‡ã‚Šæ›¿ãˆã‚’é–‹å§‹');
                    
                    // STDIOåˆ‡ã‚Šæ›¿ãˆå‡¦ç†
                    await this.configManager.switchTransport('stdio');
                    
                    MCPUIComponents.showModal(
                        'âœ… STDIOåˆ‡ã‚Šæ›¿ãˆå®Œäº†',
                        `<p>STDIOã¸ã®åˆ‡ã‚Šæ›¿ãˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚</p>
                         <p><strong>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:</strong></p>
                         <ol style="margin: 10px 0 0 20px;">
                           <li>ã“ã®Web UIã¯ä½¿ç”¨ã§ããªããªã‚Šã¾ã™</li>
                           <li>Claude Desktopã§æ–°ã—ã„ä¼šè©±ã‚’é–‹å§‹</li>
                           <li>ã¾ãŸã¯ã€ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§æ“ä½œ</li>
                         </ol>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                    );

                    // UIçŠ¶æ…‹æ›´æ–°
                    this.updateTransportStatus('stdio');
                    this.addOperationHistory('Transportåˆ‡ã‚Šæ›¿ãˆ', 'STDIOã¸ã®åˆ‡ã‚Šæ›¿ãˆå®Œäº†');
                    
                } catch (error) {
                    this.addOperationHistory('ã‚¨ãƒ©ãƒ¼', `STDIOåˆ‡ã‚Šæ›¿ãˆå¤±æ•—: ${error.message}`);
                    MCPUIComponents.showModal(
                        'âŒ STDIOåˆ‡ã‚Šæ›¿ãˆå¤±æ•—',
                        `<p>STDIOã¸ã®åˆ‡ã‚Šæ›¿ãˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p><p>${error.message}</p>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'danger' }]
                    );
                }
            }

            async switchToHttp() {
                const port = parseInt(this.httpPortInput.value);
                
                if (port < 1024 || port > 65535) {
                    MCPUIComponents.showModal(
                        'âš ï¸ ç„¡åŠ¹ãªãƒãƒ¼ãƒˆç•ªå·',
                        '<p>ãƒãƒ¼ãƒˆç•ªå·ã¯1024ã‹ã‚‰65535ã®é–“ã§æŒ‡å®šã—ã¦ãã ã•ã„ã€‚</p>',
                        [{ text: 'é–‰ã˜ã‚‹', type: 'warning' }]
                    );
                    return;
                }

                try {
                    this.addOperationHistory('Transportåˆ‡ã‚Šæ›¿ãˆ', `HTTPãƒãƒ¼ãƒˆ${port}ã¸ã®åˆ‡ã‚Šæ›¿ãˆã‚’é–‹å§‹`);
                    
                    // HTTPåˆ‡ã‚Šæ›¿ãˆå‡¦ç†
                    await this.configManager.switchTransport('http', { port });
                    
                    MCPUIComponents.showModal(
                        'âœ… HTTPåˆ‡ã‚Šæ›¿ãˆå®Œäº†',
                        `<p>HTTP Transport (ãƒãƒ¼ãƒˆ${port}) ã¸ã®åˆ‡ã‚Šæ›¿ãˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚</p>
                         <p><strong>ã‚¢ã‚¯ã‚»ã‚¹ URL:</strong> http://127.0.0.1:${port}/mcp</p>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                    );

                    // UIçŠ¶æ…‹æ›´æ–°
                    this.updateTransportStatus('http', port);
                    this.addOperationHistory('Transportåˆ‡ã‚Šæ›¿ãˆ', `HTTPãƒãƒ¼ãƒˆ${port}ã¸ã®åˆ‡ã‚Šæ›¿ãˆå®Œäº†`);
                    
                } catch (error) {
                    this.addOperationHistory('ã‚¨ãƒ©ãƒ¼', `HTTPåˆ‡ã‚Šæ›¿ãˆå¤±æ•—: ${error.message}`);
                    MCPUIComponents.showModal(
                        'âŒ HTTPåˆ‡ã‚Šæ›¿ãˆå¤±æ•—',
                        `<p>HTTPã¸ã®åˆ‡ã‚Šæ›¿ãˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p><p>${error.message}</p>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'danger' }]
                    );
                }
            }

            async applyTransportConfig() {
                const config = {
                    maxConnections: parseInt(this.maxConnectionsInput.value),
                    timeout: parseInt(this.timeoutInput.value),
                    corsEnabled: this.corsEnabledCheckbox.checked
                };

                try {
                    this.addOperationHistory('è¨­å®šå¤‰æ›´', 'Transportè¨­å®šã‚’é©ç”¨ä¸­');
                    
                    // è¨­å®šé©ç”¨å‡¦ç†ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
                    await this.applyConfigMock(config);
                    
                    MCPUIComponents.showModal(
                        'âœ… è¨­å®šé©ç”¨å®Œäº†',
                        `<p>Transportè¨­å®šãŒæ­£å¸¸ã«é©ç”¨ã•ã‚Œã¾ã—ãŸã€‚</p>
                         <ul style="margin: 10px 0 0 20px;">
                           <li>æœ€å¤§æ¥ç¶šæ•°: ${config.maxConnections}</li>
                           <li>ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: ${config.timeout}ms</li>
                           <li>CORS: ${config.corsEnabled ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹'}</li>
                         </ul>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                    );

                    this.addOperationHistory('è¨­å®šå¤‰æ›´', 'Transportè¨­å®šé©ç”¨å®Œäº†');
                    
                } catch (error) {
                    this.addOperationHistory('ã‚¨ãƒ©ãƒ¼', `è¨­å®šé©ç”¨å¤±æ•—: ${error.message}`);
                }
            }

            toggleMonitoring() {
                const button = document.getElementById('start-monitoring');
                
                if (this.monitoringInterval) {
                    // ç›£è¦–åœæ­¢
                    clearInterval(this.monitoringInterval);
                    this.monitoringInterval = null;
                    button.textContent = 'ğŸ“ˆ ç›£è¦–é–‹å§‹';
                    button.className = 'mcp-btn secondary full-width';
                    this.addOperationHistory('ç›£è¦–', 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ã‚’åœæ­¢');
                } else {
                    // ç›£è¦–é–‹å§‹
                    this.monitoringInterval = setInterval(() => {
                        this.updateStats();
                    }, 2000);
                    button.textContent = 'â¹ï¸ ç›£è¦–åœæ­¢';
                    button.className = 'mcp-btn warning full-width';
                    this.addOperationHistory('ç›£è¦–', 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ã‚’é–‹å§‹');
                }
            }

            async testCurrentTransport() {
                try {
                    this.addOperationHistory('ãƒ†ã‚¹ãƒˆ', 'ç¾åœ¨ã®Transportæ¥ç¶šãƒ†ã‚¹ãƒˆé–‹å§‹');
                    
                    const startTime = Date.now();
                    await this.client.testConnection();
                    const duration = Date.now() - startTime;
                    
                    MCPUIComponents.showModal(
                        'âœ… Transportæ¥ç¶šãƒ†ã‚¹ãƒˆæˆåŠŸ',
                        `<p>ç¾åœ¨ã®Transportã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ã€‚</p>
                         <p><strong>ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“:</strong> ${duration}ms</p>
                         <p><strong>Transport:</strong> ${this.currentTransport.toUpperCase()}</p>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                    );

                    this.addOperationHistory('ãƒ†ã‚¹ãƒˆ', `æ¥ç¶šãƒ†ã‚¹ãƒˆæˆåŠŸ (${duration}ms)`);
                    
                } catch (error) {
                    this.addOperationHistory('ã‚¨ãƒ©ãƒ¼', `æ¥ç¶šãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
                    MCPUIComponents.showModal(
                        'âŒ Transportæ¥ç¶šãƒ†ã‚¹ãƒˆå¤±æ•—',
                        `<p>ç¾åœ¨ã®Transportã§å•é¡ŒãŒç™ºç”Ÿã—ã¦ã„ã¾ã™ã€‚</p><p>${error.message}</p>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'danger' }]
                    );
                }
            }

            async benchmarkTransport() {
                MCPUIComponents.showModal(
                    'âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­',
                    '<p>è¤‡æ•°ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...</p><div class="mcp-loading" style="margin: 20px auto;"></div>',
                    []
                );

                try {
                    this.addOperationHistory('ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯', 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹');
                    
                    const testCount = 10;
                    const results = [];
                    
                    for (let i = 0; i < testCount; i++) {
                        const startTime = Date.now();
                        await this.client.testConnection();
                        results.push(Date.now() - startTime);
                    }

                    const avgTime = results.reduce((a, b) => a + b) / results.length;
                    const minTime = Math.min(...results);
                    const maxTime = Math.max(...results);

                    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã¦çµæœè¡¨ç¤º
                    document.querySelector('.modal').remove();
                    
                    MCPUIComponents.showModal(
                        'ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆçµæœ',
                        `<p><strong>ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå›æ•°:</strong> ${testCount}å›</p>
                         <p><strong>å¹³å‡ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“:</strong> ${avgTime.toFixed(1)}ms</p>
                         <p><strong>æœ€çŸ­æ™‚é–“:</strong> ${minTime}ms</p>
                         <p><strong>æœ€é•·æ™‚é–“:</strong> ${maxTime}ms</p>
                         <p><strong>æˆåŠŸç‡:</strong> 100%</p>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                    );

                    this.addOperationHistory('ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯', `ãƒ†ã‚¹ãƒˆå®Œäº† (å¹³å‡${avgTime.toFixed(1)}ms)`);
                    
                } catch (error) {
                    document.querySelector('.modal').remove();
                    this.addOperationHistory('ã‚¨ãƒ©ãƒ¼', `ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
                }
            }

            resetStats() {
                MCPUIComponents.showModal(
                    'ğŸ”„ çµ±è¨ˆãƒªã‚»ãƒƒãƒˆç¢ºèª',
                    '<p>Transportçµ±è¨ˆæƒ…å ±ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ</p><p>ã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚</p>',
                    [
                        { 
                            text: 'ãƒªã‚»ãƒƒãƒˆå®Ÿè¡Œ', 
                            type: 'warning',
                            onclick: 'this.closest(\'.modal\').remove(); window.transportManager.executeStatsReset();'
                        },
                        { text: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«', type: 'secondary' }
                    ]
                );
            }

            executeStatsReset() {
                // çµ±è¨ˆæƒ…å ±ã‚’ãƒªã‚»ãƒƒãƒˆ
                this.updateTransportStatistics(0, 0, 0);
                this.addOperationHistory('çµ±è¨ˆãƒªã‚»ãƒƒãƒˆ', 'Transportçµ±è¨ˆæƒ…å ±ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
                
                MCPUIComponents.showModal(
                    'âœ… çµ±è¨ˆãƒªã‚»ãƒƒãƒˆå®Œäº†',
                    '<p>Transportçµ±è¨ˆæƒ…å ±ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã—ãŸã€‚</p>',
                    [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                );
            }

            forceDisconnect() {
                MCPUIComponents.showModal(
                    'âš ï¸ å¼·åˆ¶åˆ‡æ–­è­¦å‘Š',
                    '<p>ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªæ¥ç¶šã‚’å¼·åˆ¶åˆ‡æ–­ã—ã¾ã™ã‹ï¼Ÿ</p><p><strong>è­¦å‘Š:</strong> é€²è¡Œä¸­ã®å‡¦ç†ãŒä¸­æ–­ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</p>',
                    [
                        { 
                            text: 'å¼·åˆ¶åˆ‡æ–­å®Ÿè¡Œ', 
                            type: 'danger',
                            onclick: 'this.closest(\'.modal\').remove(); window.transportManager.executeForceDisconnect();'
                        },
                        { text: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«', type: 'secondary' }
                    ]
                );
            }

            executeForceDisconnect() {
                this.addOperationHistory('å¼·åˆ¶åˆ‡æ–­', 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ¥ç¶šã‚’å¼·åˆ¶åˆ‡æ–­ã—ã¾ã—ãŸ');
                
                MCPUIComponents.showModal(
                    'âš ï¸ å¼·åˆ¶åˆ‡æ–­å®Œäº†',
                    '<p>ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªæ¥ç¶šãŒå¼·åˆ¶åˆ‡æ–­ã•ã‚Œã¾ã—ãŸã€‚</p><p>æ–°ã—ã„æ¥ç¶šã¯æ­£å¸¸ã«å—ã‘ä»˜ã‘ã‚‰ã‚Œã¾ã™ã€‚</p>',
                    [{ text: 'é–‰ã˜ã‚‹', type: 'warning' }]
                );
            }

            updateTransportStatus(type, port = null) {
                const activeTransportEl = document.getElementById('active-transport');
                
                if (type === 'stdio') {
                    activeTransportEl.innerHTML = `
                        <span style="color: #6c757d; font-size: 1.2em;">ğŸ“¡ STDIO</span>
                        <p style="margin: 5px 0 0 0; color: #6c757d;">æ¨™æº–å…¥å‡ºåŠ›</p>
                    `;
                } else if (type === 'http') {
                    activeTransportEl.innerHTML = `
                        <span style="color: #28a745; font-size: 1.2em;">ğŸŒ HTTP</span>
                        <p style="margin: 5px 0 0 0; color: #6c757d;">Port: ${port || 8081}</p>
                    `;
                }
                
                this.currentTransport = type;
            }

            updateTransportStatistics(requests, successRate, avgTime) {
                document.getElementById('transport-statistics').innerHTML = `
                    <div class="mcp-grid cols-3">
                        <div style="text-align: center; padding: 15px; background: #e7f3ff; border-radius: 8px;">
                            <h5>ç·ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°</h5>
                            <div style="font-size: 2em; color: #007bff;"><strong>${requests.toLocaleString()}</strong></div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #d4edda; border-radius: 8px;">
                            <h5>æˆåŠŸç‡</h5>
                            <div style="font-size: 2em; color: #28a745;"><strong>${successRate}%</strong></div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #fff3cd; border-radius: 8px;">
                            <h5>å¹³å‡ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“</h5>
                            <div style="font-size: 2em; color: #ffc107;"><strong>${avgTime}ms</strong></div>
                        </div>
                    </div>
                `;
            }

            startStatusMonitoring() {
                // å®šæœŸçš„ãªçŠ¶æ…‹æ›´æ–°
                setInterval(() => {
                    if (this.client.isConnected) {
                        this.updateStats();
                    }
                }, 5000);
            }

            updateStats() {
                // ãƒ¢ãƒƒã‚¯çµ±è¨ˆãƒ‡ãƒ¼ã‚¿æ›´æ–°
                const requests = Math.floor(Math.random() * 100) + 1200;
                const successRate = 99.2 + Math.random() * 0.8;
                const avgTime = Math.floor(Math.random() * 50) + 120;
                
                this.updateTransportStatistics(requests, successRate.toFixed(1), avgTime);
            }

            async applyConfigMock(config) {
                // è¨­å®šé©ç”¨ã®ãƒ¢ãƒƒã‚¯å®Ÿè£…
                await new Promise(resolve => setTimeout(resolve, 1000));
                console.log('Applied config:', config);
            }

            addOperationHistory(type, message) {
                this.operationHistory.unshift({
                    type,
                    message,
                    timestamp: new Date().toLocaleString('ja-JP')
                });

                if (this.operationHistory.length > 20) {
                    this.operationHistory = this.operationHistory.slice(0, 20);
                }

                this.updateHistoryDisplay();
            }

            updateHistoryDisplay() {
                const container = document.getElementById('transport-history');
                
                if (this.operationHistory.length === 0) {
                    container.innerHTML = `
                        <div class="text-center" style="color: #6c757d; padding: 20px;">
                            <p>Transportæ“ä½œå±¥æ­´ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.operationHistory.map(op => `
                    <div style="padding: 10px; border-left: 3px solid #17a2b8; margin-bottom: 10px; background: #f8f9fa;">
                        <strong>${op.type}</strong> - ${op.message}
                        <br><small style="color: #6c757d;">${op.timestamp}</small>
                    </div>
                `).join('');
            }
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            window.transportManager = new TransportManager();
        });
    </script>
</body>
</html>