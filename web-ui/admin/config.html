<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚µãƒ¼ãƒãƒ¼è¨­å®š - MCP-RS Web UI</title>
    <link rel="stylesheet" href="../shared/mcp-ui.css">
</head>
<body>
    <div class="mcp-container mcp-fade-in">
        <header class="mcp-header">
            <h1>âš™ï¸ ã‚µãƒ¼ãƒãƒ¼è¨­å®š</h1>
            <p>MCP-RSã‚µãƒ¼ãƒãƒ¼ã®è©³ç´°è¨­å®šã¨ç®¡ç†</p>
        </header>

        <nav class="mcp-nav">
            <ul>
                <li><a href="../index.html" id="nav-home">ğŸ  ãƒ›ãƒ¼ãƒ </a></li>
                <li><a href="../wordpress/dashboard.html" id="nav-wordpress">ğŸ”— WordPressç®¡ç†</a></li>
                <li><a href="config.html" id="nav-config" class="active">âš™ï¸ ã‚µãƒ¼ãƒãƒ¼è¨­å®š</a></li>
                <li><a href="transport.html" id="nav-transport">ğŸŒ Transportç®¡ç†</a></li>
                <li><a href="logs.html" id="nav-logs">ğŸ“‹ ãƒ­ã‚°ç®¡ç†</a></li>
            </ul>
        </nav>

        <main class="mcp-main">
            <!-- ã‚µãƒ¼ãƒãƒ¼æƒ…å ± -->
            <div class="mcp-card">
                <h3>ğŸ–¥ï¸ ã‚µãƒ¼ãƒãƒ¼æƒ…å ±</h3>
                <div class="mcp-grid cols-3">
                    <div class="mcp-card">
                        <h4>ğŸ“Š åŸºæœ¬æƒ…å ±</h4>
                        <p><strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³:</strong> 0.16.0</p>
                        <p><strong>Rust:</strong> 1.75.0</p>
                        <p><strong>ç¨¼åƒæ™‚é–“:</strong> <span id="uptime">2h 45m</span></p>
                        <p><strong>PID:</strong> 12345</p>
                    </div>
                    <div class="mcp-card">
                        <h4>ğŸ”§ ç¾åœ¨ã®è¨­å®š</h4>
                        <p><strong>Transport:</strong> <span id="current-transport">HTTP</span></p>
                        <p><strong>ãƒãƒ¼ãƒˆ:</strong> <span id="current-port">8081</span></p>
                        <p><strong>ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«:</strong> <span id="current-log-level">INFO</span></p>
                        <p><strong>ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰:</strong> <span id="debug-mode">OFF</span></p>
                    </div>
                    <div class="mcp-card">
                        <h4>ğŸ’¾ ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡</h4>
                        <p><strong>CPU:</strong> <span id="cpu-usage">15.2%</span></p>
                        <p><strong>ãƒ¡ãƒ¢ãƒª:</strong> <span id="memory-usage">45.8MB</span></p>
                        <p><strong>ã‚¹ãƒ¬ãƒƒãƒ‰æ•°:</strong> <span id="thread-count">8</span></p>
                        <p><strong>ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒ³ãƒ‰ãƒ«:</strong> <span id="file-handles">23</span></p>
                    </div>
                </div>
            </div>

            <div class="mcp-grid cols-2">
                <!-- åŸºæœ¬è¨­å®š -->
                <div class="mcp-card">
                    <h3>ğŸ”§ åŸºæœ¬è¨­å®š</h3>
                    
                    <div class="mb-2">
                        <h4>ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š</h4>
                        <label for="server-host"><strong>ãƒ›ã‚¹ãƒˆ</strong></label>
                        <input type="text" class="mcp-input" id="server-host" 
                               value="127.0.0.1" placeholder="127.0.0.1">
                        
                        <label for="server-port"><strong>ãƒãƒ¼ãƒˆ</strong></label>
                        <input type="number" class="mcp-input" id="server-port" 
                               value="8081" min="1024" max="65535">
                        
                        <label>
                            <input type="checkbox" id="auto-start" checked>
                            <strong>è‡ªå‹•èµ·å‹•</strong>
                        </label>
                        
                        <label>
                            <input type="checkbox" id="enable-cors" checked>
                            <strong>CORSæœ‰åŠ¹åŒ–</strong>
                        </label>
                    </div>

                    <div class="mb-2">
                        <h4>ğŸ“ ãƒ­ã‚°è¨­å®š</h4>
                        <label for="log-level"><strong>ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«</strong></label>
                        <select class="mcp-input" id="log-level">
                            <option value="TRACE">TRACE (è©³ç´°)</option>
                            <option value="DEBUG">DEBUG (ãƒ‡ãƒãƒƒã‚°)</option>
                            <option value="INFO" selected>INFO (æƒ…å ±)</option>
                            <option value="WARN">WARN (è­¦å‘Š)</option>
                            <option value="ERROR">ERROR (ã‚¨ãƒ©ãƒ¼)</option>
                        </select>
                        
                        <label for="log-file"><strong>ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«</strong></label>
                        <input type="text" class="mcp-input" id="log-file" 
                               value="logs/mcp-rs.log" placeholder="ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹">
                        
                        <label>
                            <input type="checkbox" id="enable-file-logging" checked>
                            <strong>ãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ã‚°æœ‰åŠ¹</strong>
                        </label>
                        
                        <label>
                            <input type="checkbox" id="log-rotation">
                            <strong>ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³</strong>
                        </label>
                    </div>

                    <div class="mb-2">
                        <h4>âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®š</h4>
                        <label for="worker-threads"><strong>ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚¹ãƒ¬ãƒƒãƒ‰æ•°</strong></label>
                        <input type="number" class="mcp-input" id="worker-threads" 
                               value="4" min="1" max="32">
                        
                        <label for="max-connections"><strong>æœ€å¤§åŒæ™‚æ¥ç¶šæ•°</strong></label>
                        <input type="number" class="mcp-input" id="max-connections" 
                               value="100" min="1" max="10000">
                        
                        <label for="request-timeout"><strong>ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ(ç§’)</strong></label>
                        <input type="number" class="mcp-input" id="request-timeout" 
                               value="30" min="1" max="300">
                    </div>

                    <button class="mcp-btn primary full-width" id="apply-basic-config">
                        ğŸ’¾ åŸºæœ¬è¨­å®šã‚’é©ç”¨
                    </button>
                </div>

                <!-- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»è©³ç´°è¨­å®š -->
                <div class="mcp-card">
                    <h3>ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»è©³ç´°è¨­å®š</h3>
                    
                    <div class="mb-2">
                        <h4>ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</h4>
                        <label>
                            <input type="checkbox" id="enable-https">
                            <strong>HTTPSæœ‰åŠ¹åŒ–</strong>
                        </label>
                        
                        <label for="tls-cert"><strong>TLSè¨¼æ˜æ›¸</strong></label>
                        <input type="text" class="mcp-input" id="tls-cert" 
                               placeholder="cert.pem" disabled>
                        
                        <label for="tls-key"><strong>TLSç§˜å¯†éµ</strong></label>
                        <input type="text" class="mcp-input" id="tls-key" 
                               placeholder="key.pem" disabled>
                        
                        <label>
                            <input type="checkbox" id="rate-limiting" checked>
                            <strong>ãƒ¬ãƒ¼ãƒˆåˆ¶é™</strong>
                        </label>
                        
                        <label for="rate-limit"><strong>ãƒ¬ãƒ¼ãƒˆåˆ¶é™ (req/min)</strong></label>
                        <input type="number" class="mcp-input" id="rate-limit" 
                               value="1000" min="1" max="100000">
                    </div>

                    <div class="mb-2">
                        <h4>ğŸ§ª é–‹ç™ºãƒ»ãƒ‡ãƒãƒƒã‚°</h4>
                        <label>
                            <input type="checkbox" id="debug-mode-toggle">
                            <strong>ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰</strong>
                        </label>
                        
                        <label>
                            <input type="checkbox" id="enable-metrics" checked>
                            <strong>ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†</strong>
                        </label>
                        
                        <label>
                            <input type="checkbox" id="enable-profiling">
                            <strong>ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°</strong>
                        </label>
                        
                        <label for="metrics-port"><strong>ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒãƒ¼ãƒˆ</strong></label>
                        <input type="number" class="mcp-input" id="metrics-port" 
                               value="9090" min="1024" max="65535">
                    </div>

                    <div class="mb-2">
                        <h4>ğŸ“¦ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ»æ‹¡å¼µ</h4>
                        <label>
                            <input type="checkbox" id="enable-plugins" checked>
                            <strong>ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚µãƒãƒ¼ãƒˆ</strong>
                        </label>
                        
                        <label for="plugin-dir"><strong>ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª</strong></label>
                        <input type="text" class="mcp-input" id="plugin-dir" 
                               value="plugins/" placeholder="plugins/">
                        
                        <label>
                            <input type="checkbox" id="hot-reload" checked>
                            <strong>ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰</strong>
                        </label>
                    </div>

                    <button class="mcp-btn primary full-width" id="apply-security-config">
                        ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã‚’é©ç”¨
                    </button>
                </div>
            </div>

            <!-- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç† -->
            <div class="mcp-card">
                <h3>ğŸ“„ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†</h3>
                
                <div class="mcp-grid cols-2">
                    <div class="mb-2">
                        <h4>ğŸ“ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«</h4>
                        <div style="margin-bottom: 15px;">
                            <strong>ç¾åœ¨ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«:</strong>
                            <code style="background: #f8f9fa; padding: 5px; border-radius: 4px; display: block; margin-top: 5px;">
                                mcp-config.toml
                            </code>
                        </div>
                        
                        <button class="mcp-btn secondary full-width mb-1" id="backup-config">
                            ğŸ’¾ è¨­å®šã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
                        </button>
                        <button class="mcp-btn secondary full-width mb-1" id="restore-config">
                            ğŸ“¥ è¨­å®šã‚’å¾©å…ƒ
                        </button>
                        <button class="mcp-btn secondary full-width mb-1" id="export-config">
                            ğŸ“¤ è¨­å®šã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                        </button>
                        <button class="mcp-btn warning full-width" id="reset-config">
                            ğŸ”„ è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆ
                        </button>
                    </div>

                    <div class="mb-2">
                        <h4>ğŸ“‹ è¨­å®šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h4>
                        <label for="config-template"><strong>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ</strong></label>
                        <select class="mcp-input" id="config-template">
                            <option value="default">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š</option>
                            <option value="development">é–‹ç™ºç’°å¢ƒ</option>
                            <option value="production">æœ¬ç•ªç’°å¢ƒ</option>
                            <option value="claude-desktop">Claude Desktopç”¨</option>
                            <option value="wordpress-focused">WordPressç‰¹åŒ–</option>
                            <option value="high-performance">é«˜æ€§èƒ½è¨­å®š</option>
                        </select>
                        
                        <button class="mcp-btn primary full-width mb-1" id="apply-template">
                            ğŸ“‹ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é©ç”¨
                        </button>
                        <button class="mcp-btn secondary full-width mb-1" id="preview-template">
                            ğŸ‘ï¸ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
                        </button>
                        <button class="mcp-btn secondary full-width" id="save-as-template">
                            ğŸ’¾ ç¾åœ¨è¨­å®šã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¿å­˜
                        </button>
                    </div>
                </div>
            </div>

            <!-- ã‚µãƒ¼ãƒãƒ¼åˆ¶å¾¡ -->
            <div class="mcp-card">
                <h3>ğŸ® ã‚µãƒ¼ãƒãƒ¼åˆ¶å¾¡</h3>
                
                <div class="mcp-grid cols-4">
                    <button class="mcp-btn primary" id="restart-server">
                        ğŸ”„ ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•
                    </button>
                    <button class="mcp-btn warning" id="reload-config">
                        âš¡ è¨­å®šãƒªãƒ­ãƒ¼ãƒ‰
                    </button>
                    <button class="mcp-btn secondary" id="health-check">
                        ğŸ¥ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
                    </button>
                    <button class="mcp-btn danger" id="shutdown-server">
                        â¹ï¸ ã‚µãƒ¼ãƒãƒ¼åœæ­¢
                    </button>
                </div>

                <div class="mt-2">
                    <h4>ğŸ“Š ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ç›£è¦–</h4>
                    <div id="server-monitoring">
                        <div class="text-center" style="color: #6c757d; padding: 20px;">
                            <p>ã‚µãƒ¼ãƒãƒ¼ç›£è¦–æƒ…å ±ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ“ä½œå±¥æ­´ -->
            <div class="mcp-card">
                <h3>ğŸ“‹ è¨­å®šå¤‰æ›´å±¥æ­´</h3>
                <div id="config-history">
                    <div class="text-center" style="color: #6c757d; padding: 20px;">
                        <p>è¨­å®šå¤‰æ›´å±¥æ­´ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
                    </div>
                </div>
            </div>
        </main>

        <footer class="mcp-footer">
            <p>
                ğŸš€ MCP-RS v0.16.0 - Server Configuration Console | 
                ğŸ’» é–‹ç™ºè€…: <strong>n-takatsu</strong> | 
                ğŸŒ <a href="https://github.com/n-takatsu/mcp-rs">GitHub</a>
            </p>
        </footer>
    </div>

    <script src="../shared/mcp-ui.js"></script>
    <script>
        class ServerConfigManager {
            constructor() {
                this.client = new MCPClient();
                this.configManager = new MCPConfigManager(this.client);
                this.configHistory = [];
                this.monitoringInterval = null;
                
                this.initializeElements();
                this.bindEvents();
                this.loadCurrentConfig();
                this.startMonitoring();
            }

            initializeElements() {
                // åŸºæœ¬è¨­å®šè¦ç´ 
                this.serverHost = document.getElementById('server-host');
                this.serverPort = document.getElementById('server-port');
                this.autoStart = document.getElementById('auto-start');
                this.enableCors = document.getElementById('enable-cors');

                // ãƒ­ã‚°è¨­å®šè¦ç´ 
                this.logLevel = document.getElementById('log-level');
                this.logFile = document.getElementById('log-file');
                this.enableFileLogging = document.getElementById('enable-file-logging');
                this.logRotation = document.getElementById('log-rotation');

                // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®šè¦ç´ 
                this.workerThreads = document.getElementById('worker-threads');
                this.maxConnections = document.getElementById('max-connections');
                this.requestTimeout = document.getElementById('request-timeout');

                // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šè¦ç´ 
                this.enableHttps = document.getElementById('enable-https');
                this.tlsCert = document.getElementById('tls-cert');
                this.tlsKey = document.getElementById('tls-key');
                this.rateLimiting = document.getElementById('rate-limiting');
                this.rateLimit = document.getElementById('rate-limit');

                // ãƒ‡ãƒãƒƒã‚°è¨­å®šè¦ç´ 
                this.debugModeToggle = document.getElementById('debug-mode-toggle');
                this.enableMetrics = document.getElementById('enable-metrics');
                this.enableProfiling = document.getElementById('enable-profiling');
                this.metricsPort = document.getElementById('metrics-port');

                // ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­å®šè¦ç´ 
                this.enablePlugins = document.getElementById('enable-plugins');
                this.pluginDir = document.getElementById('plugin-dir');
                this.hotReload = document.getElementById('hot-reload');

                // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè¦ç´ 
                this.configTemplate = document.getElementById('config-template');

                // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
                MCPUIComponents.setActiveNav('nav-config');
            }

            bindEvents() {
                // HTTPSåˆ‡ã‚Šæ›¿ãˆã§TLSè¨­å®šã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’åˆ‡ã‚Šæ›¿ãˆ
                this.enableHttps.addEventListener('change', (e) => {
                    this.tlsCert.disabled = !e.target.checked;
                    this.tlsKey.disabled = !e.target.checked;
                });

                // è¨­å®šé©ç”¨ãƒœã‚¿ãƒ³
                document.getElementById('apply-basic-config').addEventListener('click', () => this.applyBasicConfig());
                document.getElementById('apply-security-config').addEventListener('click', () => this.applySecurityConfig());

                // è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
                document.getElementById('backup-config').addEventListener('click', () => this.backupConfig());
                document.getElementById('restore-config').addEventListener('click', () => this.restoreConfig());
                document.getElementById('export-config').addEventListener('click', () => this.exportConfig());
                document.getElementById('reset-config').addEventListener('click', () => this.resetConfig());

                // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†
                document.getElementById('apply-template').addEventListener('click', () => this.applyTemplate());
                document.getElementById('preview-template').addEventListener('click', () => this.previewTemplate());
                document.getElementById('save-as-template').addEventListener('click', () => this.saveAsTemplate());

                // ã‚µãƒ¼ãƒãƒ¼åˆ¶å¾¡
                document.getElementById('restart-server').addEventListener('click', () => this.restartServer());
                document.getElementById('reload-config').addEventListener('click', () => this.reloadConfig());
                document.getElementById('health-check').addEventListener('click', () => this.healthCheck());
                document.getElementById('shutdown-server').addEventListener('click', () => this.shutdownServer());
            }

            async loadCurrentConfig() {
                try {
                    // ç¾åœ¨ã®è¨­å®šã‚’å–å¾—ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
                    const config = await this.getCurrentConfigMock();
                    this.populateConfigForm(config);
                    this.updateServerInfo(config);
                } catch (error) {
                    console.error('è¨­å®šèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                }
            }

            populateConfigForm(config) {
                // ãƒ•ã‚©ãƒ¼ãƒ ã«è¨­å®šå€¤ã‚’åæ˜ 
                this.serverHost.value = config.host || '127.0.0.1';
                this.serverPort.value = config.port || 8081;
                this.autoStart.checked = config.auto_start || false;
                this.enableCors.checked = config.enable_cors || false;
                
                this.logLevel.value = config.log_level || 'INFO';
                this.logFile.value = config.log_file || 'logs/mcp-rs.log';
                this.enableFileLogging.checked = config.enable_file_logging || false;
                this.logRotation.checked = config.log_rotation || false;
                
                this.workerThreads.value = config.worker_threads || 4;
                this.maxConnections.value = config.max_connections || 100;
                this.requestTimeout.value = config.request_timeout || 30;
                
                this.enableHttps.checked = config.enable_https || false;
                this.tlsCert.value = config.tls_cert || '';
                this.tlsKey.value = config.tls_key || '';
                this.rateLimiting.checked = config.rate_limiting || false;
                this.rateLimit.value = config.rate_limit || 1000;
                
                this.debugModeToggle.checked = config.debug_mode || false;
                this.enableMetrics.checked = config.enable_metrics || false;
                this.enableProfiling.checked = config.enable_profiling || false;
                this.metricsPort.value = config.metrics_port || 9090;
                
                this.enablePlugins.checked = config.enable_plugins || false;
                this.pluginDir.value = config.plugin_dir || 'plugins/';
                this.hotReload.checked = config.hot_reload || false;

                // HTTPSè¨­å®šã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’åæ˜ 
                this.tlsCert.disabled = !this.enableHttps.checked;
                this.tlsKey.disabled = !this.enableHttps.checked;
            }

            updateServerInfo(config) {
                document.getElementById('current-transport').textContent = config.transport || 'HTTP';
                document.getElementById('current-port').textContent = config.port || '8081';
                document.getElementById('current-log-level').textContent = config.log_level || 'INFO';
                document.getElementById('debug-mode').textContent = config.debug_mode ? 'ON' : 'OFF';
            }

            async applyBasicConfig() {
                const config = {
                    host: this.serverHost.value,
                    port: parseInt(this.serverPort.value),
                    auto_start: this.autoStart.checked,
                    enable_cors: this.enableCors.checked,
                    log_level: this.logLevel.value,
                    log_file: this.logFile.value,
                    enable_file_logging: this.enableFileLogging.checked,
                    log_rotation: this.logRotation.checked,
                    worker_threads: parseInt(this.workerThreads.value),
                    max_connections: parseInt(this.maxConnections.value),
                    request_timeout: parseInt(this.requestTimeout.value)
                };

                try {
                    this.addConfigHistory('åŸºæœ¬è¨­å®šå¤‰æ›´', 'åŸºæœ¬è¨­å®šã‚’é©ç”¨ä¸­');
                    
                    // è¨­å®šé©ç”¨å‡¦ç†ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
                    await this.applyConfigMock(config, 'basic');
                    
                    MCPUIComponents.showModal(
                        'âœ… åŸºæœ¬è¨­å®šé©ç”¨å®Œäº†',
                        `<p>åŸºæœ¬è¨­å®šãŒæ­£å¸¸ã«é©ç”¨ã•ã‚Œã¾ã—ãŸã€‚</p>
                         <ul style="margin: 10px 0 0 20px;">
                           <li>ãƒ›ã‚¹ãƒˆ: ${config.host}</li>
                           <li>ãƒãƒ¼ãƒˆ: ${config.port}</li>
                           <li>ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«: ${config.log_level}</li>
                           <li>ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚¹ãƒ¬ãƒƒãƒ‰: ${config.worker_threads}</li>
                         </ul>
                         <p><strong>æ³¨æ„:</strong> ä¸€éƒ¨è¨­å®šã¯å†èµ·å‹•å¾Œã«æœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚</p>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                    );

                    this.updateServerInfo(config);
                    this.addConfigHistory('åŸºæœ¬è¨­å®šå¤‰æ›´', 'åŸºæœ¬è¨­å®šé©ç”¨å®Œäº†');
                    
                } catch (error) {
                    this.addConfigHistory('ã‚¨ãƒ©ãƒ¼', `åŸºæœ¬è¨­å®šé©ç”¨å¤±æ•—: ${error.message}`);
                    MCPUIComponents.showModal(
                        'âŒ åŸºæœ¬è¨­å®šé©ç”¨å¤±æ•—',
                        `<p>åŸºæœ¬è¨­å®šã®é©ç”¨ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p><p>${error.message}</p>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'danger' }]
                    );
                }
            }

            async applySecurityConfig() {
                const config = {
                    enable_https: this.enableHttps.checked,
                    tls_cert: this.tlsCert.value,
                    tls_key: this.tlsKey.value,
                    rate_limiting: this.rateLimiting.checked,
                    rate_limit: parseInt(this.rateLimit.value),
                    debug_mode: this.debugModeToggle.checked,
                    enable_metrics: this.enableMetrics.checked,
                    enable_profiling: this.enableProfiling.checked,
                    metrics_port: parseInt(this.metricsPort.value),
                    enable_plugins: this.enablePlugins.checked,
                    plugin_dir: this.pluginDir.value,
                    hot_reload: this.hotReload.checked
                };

                try {
                    this.addConfigHistory('ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šå¤‰æ›´', 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã‚’é©ç”¨ä¸­');
                    
                    // è¨­å®šé©ç”¨å‡¦ç†ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
                    await this.applyConfigMock(config, 'security');
                    
                    MCPUIComponents.showModal(
                        'ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šé©ç”¨å®Œäº†',
                        `<p>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šãŒæ­£å¸¸ã«é©ç”¨ã•ã‚Œã¾ã—ãŸã€‚</p>
                         <ul style="margin: 10px 0 0 20px;">
                           <li>HTTPS: ${config.enable_https ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹'}</li>
                           <li>ãƒ¬ãƒ¼ãƒˆåˆ¶é™: ${config.rate_limiting ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹'}</li>
                           <li>ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰: ${config.debug_mode ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹'}</li>
                           <li>ãƒ¡ãƒˆãƒªã‚¯ã‚¹: ${config.enable_metrics ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹'}</li>
                         </ul>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                    );

                    this.addConfigHistory('ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šå¤‰æ›´', 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šé©ç”¨å®Œäº†');
                    
                } catch (error) {
                    this.addConfigHistory('ã‚¨ãƒ©ãƒ¼', `ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šé©ç”¨å¤±æ•—: ${error.message}`);
                    MCPUIComponents.showModal(
                        'âŒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šé©ç”¨å¤±æ•—',
                        `<p>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã®é©ç”¨ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p><p>${error.message}</p>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'danger' }]
                    );
                }
            }

            backupConfig() {
                try {
                    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                    const filename = `mcp-config-backup-${timestamp}.toml`;
                    
                    MCPUIComponents.showModal(
                        'âœ… è¨­å®šãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†',
                        `<p>è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã•ã‚Œã¾ã—ãŸã€‚</p>
                         <p><strong>ãƒ•ã‚¡ã‚¤ãƒ«å:</strong> ${filename}</p>
                         <p><strong>å ´æ‰€:</strong> backups/</p>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                    );

                    this.addConfigHistory('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—', `è¨­å®šã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: ${filename}`);
                } catch (error) {
                    this.addConfigHistory('ã‚¨ãƒ©ãƒ¼', `ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¤±æ•—: ${error.message}`);
                }
            }

            restoreConfig() {
                MCPUIComponents.showModal(
                    'ğŸ“¥ è¨­å®šå¾©å…ƒ',
                    `<p>ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰è¨­å®šã‚’å¾©å…ƒã—ã¾ã™ã€‚</p>
                     <label for="restore-file"><strong>å¾©å…ƒãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ:</strong></label>
                     <input type="file" id="restore-file" accept=".toml" style="width: 100%; margin: 10px 0;">
                     <p><strong>âš ï¸ æ³¨æ„:</strong> ç¾åœ¨ã®è¨­å®šã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚</p>`,
                    [
                        { 
                            text: 'å¾©å…ƒå®Ÿè¡Œ', 
                            type: 'warning',
                            onclick: 'window.serverConfigManager.executeRestore();'
                        },
                        { text: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«', type: 'secondary' }
                    ]
                );
            }

            executeRestore() {
                const fileInput = document.getElementById('restore-file');
                if (fileInput.files.length === 0) {
                    MCPUIComponents.showModal(
                        'âš ï¸ ãƒ•ã‚¡ã‚¤ãƒ«æœªé¸æŠ',
                        '<p>å¾©å…ƒã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>',
                        [{ text: 'é–‰ã˜ã‚‹', type: 'warning' }]
                    );
                    return;
                }

                // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
                document.querySelector('.modal').remove();
                
                MCPUIComponents.showModal(
                    'âœ… è¨­å®šå¾©å…ƒå®Œäº†',
                    '<p>è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£å¸¸ã«å¾©å…ƒã•ã‚Œã¾ã—ãŸã€‚</p><p>ã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ã—ã¦å¤‰æ›´ã‚’é©ç”¨ã—ã¦ãã ã•ã„ã€‚</p>',
                    [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                );

                this.addConfigHistory('å¾©å…ƒ', 'è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¾©å…ƒã—ã¾ã—ãŸ');
                this.loadCurrentConfig();
            }

            exportConfig() {
                try {
                    const config = this.getCurrentConfigFromForm();
                    const configToml = this.generateConfigToml(config);
                    
                    // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’ä½œæˆ
                    const blob = new Blob([configToml], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'mcp-config-export.toml';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    MCPUIComponents.showModal(
                        'ğŸ“¤ è¨­å®šã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†',
                        '<p>ç¾åœ¨ã®è¨­å®šãŒTOMLãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸã€‚</p>',
                        [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                    );

                    this.addConfigHistory('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ', 'è¨­å®šã‚’TOMLãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ');
                } catch (error) {
                    this.addConfigHistory('ã‚¨ãƒ©ãƒ¼', `ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå¤±æ•—: ${error.message}`);
                }
            }

            resetConfig() {
                MCPUIComponents.showModal(
                    'ğŸ”„ è¨­å®šãƒªã‚»ãƒƒãƒˆç¢ºèª',
                    `<p><strong>âš ï¸ è­¦å‘Š:</strong> ã™ã¹ã¦ã®è¨­å®šãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚</p>
                     <p>ã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ</p>`,
                    [
                        { 
                            text: 'ãƒªã‚»ãƒƒãƒˆå®Ÿè¡Œ', 
                            type: 'danger',
                            onclick: 'this.closest(\'.modal\').remove(); window.serverConfigManager.executeConfigReset();'
                        },
                        { text: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«', type: 'secondary' }
                    ]
                );
            }

            executeConfigReset() {
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’é©ç”¨
                const defaultConfig = this.getDefaultConfig();
                this.populateConfigForm(defaultConfig);
                
                MCPUIComponents.showModal(
                    'âœ… è¨­å®šãƒªã‚»ãƒƒãƒˆå®Œäº†',
                    '<p>ã™ã¹ã¦ã®è¨­å®šãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã—ãŸã€‚</p><p>ã€Œè¨­å®šã‚’é©ç”¨ã€ãƒœã‚¿ãƒ³ã§ã‚µãƒ¼ãƒãƒ¼ã«åæ˜ ã—ã¦ãã ã•ã„ã€‚</p>',
                    [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                );

                this.addConfigHistory('ãƒªã‚»ãƒƒãƒˆ', 'è¨­å®šã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«ãƒªã‚»ãƒƒãƒˆ');
            }

            applyTemplate() {
                const templateType = this.configTemplate.value;
                const template = this.getConfigTemplate(templateType);
                
                MCPUIComponents.showModal(
                    'ğŸ“‹ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé©ç”¨ç¢ºèª',
                    `<p><strong>${this.getTemplateName(templateType)}</strong>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é©ç”¨ã—ã¾ã™ã‹ï¼Ÿ</p>
                     <p>ç¾åœ¨ã®è¨­å®šå€¤ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚</p>`,
                    [
                        { 
                            text: 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé©ç”¨', 
                            type: 'primary',
                            onclick: `this.closest('.modal').remove(); window.serverConfigManager.executeTemplateApply('${templateType}');`
                        },
                        { text: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«', type: 'secondary' }
                    ]
                );
            }

            executeTemplateApply(templateType) {
                const template = this.getConfigTemplate(templateType);
                this.populateConfigForm(template);
                
                MCPUIComponents.showModal(
                    'âœ… ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé©ç”¨å®Œäº†',
                    `<p><strong>${this.getTemplateName(templateType)}</strong>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒé©ç”¨ã•ã‚Œã¾ã—ãŸã€‚</p>
                     <p>ã€Œè¨­å®šã‚’é©ç”¨ã€ãƒœã‚¿ãƒ³ã§ã‚µãƒ¼ãƒãƒ¼ã«åæ˜ ã—ã¦ãã ã•ã„ã€‚</p>`,
                    [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                );

                this.addConfigHistory('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé©ç”¨', `${this.getTemplateName(templateType)}ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é©ç”¨`);
            }

            previewTemplate() {
                const templateType = this.configTemplate.value;
                const template = this.getConfigTemplate(templateType);
                const toml = this.generateConfigToml(template);
                
                MCPUIComponents.showModal(
                    `ğŸ‘ï¸ ${this.getTemplateName(templateType)}ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼`,
                    `<pre style="background: #f8f9fa; padding: 15px; border-radius: 6px; max-height: 400px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 0.9em;">${toml}</pre>`,
                    [
                        { 
                            text: 'ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é©ç”¨', 
                            type: 'primary',
                            onclick: `this.closest('.modal').remove(); window.serverConfigManager.executeTemplateApply('${templateType}');`
                        },
                        { text: 'é–‰ã˜ã‚‹', type: 'secondary' }
                    ]
                );
            }

            saveAsTemplate() {
                MCPUIComponents.showModal(
                    'ğŸ’¾ ç¾åœ¨è¨­å®šã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¿å­˜',
                    `<p>ç¾åœ¨ã®è¨­å®šå€¤ã‚’æ–°ã—ã„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚</p>
                     <label for="template-name"><strong>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå:</strong></label>
                     <input type="text" id="template-name" class="mcp-input" placeholder="ã‚«ã‚¹ã‚¿ãƒ è¨­å®š" style="width: 100%; margin: 10px 0;">
                     <label for="template-description"><strong>èª¬æ˜:</strong></label>
                     <textarea id="template-description" class="mcp-input" placeholder="ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®èª¬æ˜" style="width: 100%; height: 80px; margin: 10px 0;"></textarea>`,
                    [
                        { 
                            text: 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¿å­˜', 
                            type: 'primary',
                            onclick: 'window.serverConfigManager.executeSaveTemplate();'
                        },
                        { text: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«', type: 'secondary' }
                    ]
                );
            }

            executeSaveTemplate() {
                const name = document.getElementById('template-name').value;
                const description = document.getElementById('template-description').value;
                
                if (!name.trim()) {
                    MCPUIComponents.showModal(
                        'âš ï¸ å…¥åŠ›ã‚¨ãƒ©ãƒ¼',
                        '<p>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>',
                        [{ text: 'é–‰ã˜ã‚‹', type: 'warning' }]
                    );
                    return;
                }

                // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
                document.querySelector('.modal').remove();
                
                MCPUIComponents.showModal(
                    'âœ… ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¿å­˜å®Œäº†',
                    `<p>ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€Œ${name}ã€ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚</p>
                     <p><strong>èª¬æ˜:</strong> ${description || '(ãªã—)'}</p>`,
                    [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                );

                this.addConfigHistory('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¿å­˜', `ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€Œ${name}ã€ã‚’ä¿å­˜`);
            }

            async restartServer() {
                MCPUIComponents.showModal(
                    'ğŸ”„ ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•ç¢ºèª',
                    '<p><strong>è­¦å‘Š:</strong> ã‚µãƒ¼ãƒãƒ¼ãŒå†èµ·å‹•ã•ã‚Œã¾ã™ã€‚</p><p>é€²è¡Œä¸­ã®å‡¦ç†ãŒä¸­æ–­ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</p><p>å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ</p>',
                    [
                        { 
                            text: 'å†èµ·å‹•å®Ÿè¡Œ', 
                            type: 'warning',
                            onclick: 'this.closest(\'.modal\').remove(); window.serverConfigManager.executeRestart();'
                        },
                        { text: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«', type: 'secondary' }
                    ]
                );
            }

            async executeRestart() {
                try {
                    this.addConfigHistory('ã‚µãƒ¼ãƒãƒ¼åˆ¶å¾¡', 'ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•ã‚’å®Ÿè¡Œ');
                    
                    MCPUIComponents.showModal(
                        'âš¡ ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•ä¸­',
                        '<p>ã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ã—ã¦ã„ã¾ã™...</p><div class="mcp-loading" style="margin: 20px auto;"></div>',
                        []
                    );

                    // å†èµ·å‹•å‡¦ç†ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
                    await new Promise(resolve => setTimeout(resolve, 3000));
                    
                    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’æ›´æ–°
                    document.querySelector('.modal').remove();
                    MCPUIComponents.showModal(
                        'âœ… ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•å®Œäº†',
                        '<p>ã‚µãƒ¼ãƒãƒ¼ãŒæ­£å¸¸ã«å†èµ·å‹•ã•ã‚Œã¾ã—ãŸã€‚</p><p>æ–°ã—ã„è¨­å®šãŒé©ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>',
                        [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                    );

                    this.addConfigHistory('ã‚µãƒ¼ãƒãƒ¼åˆ¶å¾¡', 'ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•å®Œäº†');
                    this.loadCurrentConfig();
                    
                } catch (error) {
                    document.querySelector('.modal').remove();
                    this.addConfigHistory('ã‚¨ãƒ©ãƒ¼', `ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•å¤±æ•—: ${error.message}`);
                }
            }

            async reloadConfig() {
                try {
                    this.addConfigHistory('è¨­å®šãƒªãƒ­ãƒ¼ãƒ‰', 'è¨­å®šãƒªãƒ­ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œ');
                    
                    // è¨­å®šãƒªãƒ­ãƒ¼ãƒ‰å‡¦ç†ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    MCPUIComponents.showModal(
                        'âš¡ è¨­å®šãƒªãƒ­ãƒ¼ãƒ‰å®Œäº†',
                        '<p>è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£å¸¸ã«ãƒªãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã—ãŸã€‚</p><p>ã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ã›ãšã«è¨­å®šãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚</p>',
                        [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                    );

                    this.addConfigHistory('è¨­å®šãƒªãƒ­ãƒ¼ãƒ‰', 'è¨­å®šãƒªãƒ­ãƒ¼ãƒ‰å®Œäº†');
                    this.loadCurrentConfig();
                    
                } catch (error) {
                    this.addConfigHistory('ã‚¨ãƒ©ãƒ¼', `è¨­å®šãƒªãƒ­ãƒ¼ãƒ‰å¤±æ•—: ${error.message}`);
                }
            }

            async healthCheck() {
                try {
                    this.addConfigHistory('ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯', 'ã‚µãƒ¼ãƒãƒ¼ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ');
                    
                    // ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å‡¦ç†ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    const healthStatus = {
                        status: 'healthy',
                        uptime: '2h 45m 30s',
                        memory: '45.8MB',
                        cpu: '15.2%',
                        connections: 3,
                        errors: 0
                    };
                    
                    MCPUIComponents.showModal(
                        'ğŸ¥ ã‚µãƒ¼ãƒãƒ¼ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯çµæœ',
                        `<div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                           <h4 style="color: #155724; margin: 0 0 10px 0;">âœ… å¥åº·çŠ¶æ…‹: æ­£å¸¸</h4>
                         </div>
                         <ul style="margin: 0 0 0 20px;">
                           <li><strong>ç¨¼åƒæ™‚é–“:</strong> ${healthStatus.uptime}</li>
                           <li><strong>ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡:</strong> ${healthStatus.memory}</li>
                           <li><strong>CPUä½¿ç”¨ç‡:</strong> ${healthStatus.cpu}</li>
                           <li><strong>ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ¥ç¶š:</strong> ${healthStatus.connections}</li>
                           <li><strong>ã‚¨ãƒ©ãƒ¼æ•°:</strong> ${healthStatus.errors}</li>
                         </ul>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                    );

                    this.addConfigHistory('ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯', 'ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Œäº† (æ­£å¸¸)');
                    
                } catch (error) {
                    this.addConfigHistory('ã‚¨ãƒ©ãƒ¼', `ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å¤±æ•—: ${error.message}`);
                    MCPUIComponents.showModal(
                        'âŒ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å¤±æ•—',
                        `<p>ã‚µãƒ¼ãƒãƒ¼ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p><p>${error.message}</p>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'danger' }]
                    );
                }
            }

            shutdownServer() {
                MCPUIComponents.showModal(
                    'â¹ï¸ ã‚µãƒ¼ãƒãƒ¼åœæ­¢ç¢ºèª',
                    '<p><strong>âš ï¸ é‡è¦:</strong> ã‚µãƒ¼ãƒãƒ¼ãŒåœæ­¢ã•ã‚Œã¾ã™ã€‚</p><p>ã“ã®æ“ä½œå¾Œã¯Web UIãŒä½¿ç”¨ã§ããªããªã‚Šã¾ã™ã€‚</p><p>æœ¬å½“ã«åœæ­¢ã—ã¾ã™ã‹ï¼Ÿ</p>',
                    [
                        { 
                            text: 'ã‚µãƒ¼ãƒãƒ¼åœæ­¢', 
                            type: 'danger',
                            onclick: 'this.closest(\'.modal\').remove(); window.serverConfigManager.executeShutdown();'
                        },
                        { text: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«', type: 'secondary' }
                    ]
                );
            }

            executeShutdown() {
                this.addConfigHistory('ã‚µãƒ¼ãƒãƒ¼åˆ¶å¾¡', 'ã‚µãƒ¼ãƒãƒ¼åœæ­¢ã‚’å®Ÿè¡Œ');
                
                MCPUIComponents.showModal(
                    'âš ï¸ ã‚µãƒ¼ãƒãƒ¼åœæ­¢å®Œäº†',
                    '<p>MCP-RSã‚µãƒ¼ãƒãƒ¼ãŒæ­£å¸¸ã«åœæ­¢ã•ã‚Œã¾ã—ãŸã€‚</p><p>ã“ã®Web UIã¯ä½¿ç”¨ã§ããªããªã‚Šã¾ã™ã€‚</p><p>å†é–‹ã™ã‚‹ã«ã¯ã‚µãƒ¼ãƒãƒ¼ã‚’æ‰‹å‹•ã§èµ·å‹•ã—ã¦ãã ã•ã„ã€‚</p>',
                    [{ text: 'é–‰ã˜ã‚‹', type: 'warning' }]
                );
            }

            startMonitoring() {
                // ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡ã®å®šæœŸæ›´æ–°
                setInterval(() => {
                    this.updateResourceUsage();
                }, 5000);
            }

            updateResourceUsage() {
                // ãƒ¢ãƒƒã‚¯ãƒªã‚½ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿
                const cpu = (Math.random() * 20 + 10).toFixed(1);
                const memory = (Math.random() * 10 + 40).toFixed(1);
                const threads = Math.floor(Math.random() * 4) + 6;
                const handles = Math.floor(Math.random() * 10) + 20;
                
                document.getElementById('cpu-usage').textContent = `${cpu}%`;
                document.getElementById('memory-usage').textContent = `${memory}MB`;
                document.getElementById('thread-count').textContent = threads;
                document.getElementById('file-handles').textContent = handles;
                
                // ç¨¼åƒæ™‚é–“æ›´æ–°
                const uptime = document.getElementById('uptime');
                if (uptime) {
                    const [hours, minutes] = uptime.textContent.match(/\d+/g) || ['2', '45'];
                    const newMinutes = parseInt(minutes) + 1;
                    if (newMinutes >= 60) {
                        uptime.textContent = `${parseInt(hours) + 1}h 0m`;
                    } else {
                        uptime.textContent = `${hours}h ${newMinutes}m`;
                    }
                }
            }

            // ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰
            getCurrentConfigFromForm() {
                return {
                    host: this.serverHost.value,
                    port: parseInt(this.serverPort.value),
                    auto_start: this.autoStart.checked,
                    enable_cors: this.enableCors.checked,
                    log_level: this.logLevel.value,
                    log_file: this.logFile.value,
                    enable_file_logging: this.enableFileLogging.checked,
                    log_rotation: this.logRotation.checked,
                    worker_threads: parseInt(this.workerThreads.value),
                    max_connections: parseInt(this.maxConnections.value),
                    request_timeout: parseInt(this.requestTimeout.value),
                    enable_https: this.enableHttps.checked,
                    tls_cert: this.tlsCert.value,
                    tls_key: this.tlsKey.value,
                    rate_limiting: this.rateLimiting.checked,
                    rate_limit: parseInt(this.rateLimit.value),
                    debug_mode: this.debugModeToggle.checked,
                    enable_metrics: this.enableMetrics.checked,
                    enable_profiling: this.enableProfiling.checked,
                    metrics_port: parseInt(this.metricsPort.value),
                    enable_plugins: this.enablePlugins.checked,
                    plugin_dir: this.pluginDir.value,
                    hot_reload: this.hotReload.checked
                };
            }

            generateConfigToml(config) {
                return `# MCP-RS Configuration File
# Generated by MCP-RS Web UI

[server]
host = "${config.host}"
port = ${config.port}
auto_start = ${config.auto_start}
enable_cors = ${config.enable_cors}

[logging]
level = "${config.log_level}"
file = "${config.log_file}"
enable_file_logging = ${config.enable_file_logging}
log_rotation = ${config.log_rotation}

[performance]
worker_threads = ${config.worker_threads}
max_connections = ${config.max_connections}
request_timeout = ${config.request_timeout}

[security]
enable_https = ${config.enable_https}
tls_cert = "${config.tls_cert}"
tls_key = "${config.tls_key}"
rate_limiting = ${config.rate_limiting}
rate_limit = ${config.rate_limit}

[development]
debug_mode = ${config.debug_mode}
enable_metrics = ${config.enable_metrics}
enable_profiling = ${config.enable_profiling}
metrics_port = ${config.metrics_port}

[plugins]
enable_plugins = ${config.enable_plugins}
plugin_dir = "${config.plugin_dir}"
hot_reload = ${config.hot_reload}`;
            }

            getDefaultConfig() {
                return {
                    host: '127.0.0.1',
                    port: 8081,
                    auto_start: false,
                    enable_cors: true,
                    log_level: 'INFO',
                    log_file: 'logs/mcp-rs.log',
                    enable_file_logging: true,
                    log_rotation: false,
                    worker_threads: 4,
                    max_connections: 100,
                    request_timeout: 30,
                    enable_https: false,
                    tls_cert: '',
                    tls_key: '',
                    rate_limiting: true,
                    rate_limit: 1000,
                    debug_mode: false,
                    enable_metrics: true,
                    enable_profiling: false,
                    metrics_port: 9090,
                    enable_plugins: true,
                    plugin_dir: 'plugins/',
                    hot_reload: true
                };
            }

            getConfigTemplate(type) {
                const templates = {
                    default: this.getDefaultConfig(),
                    development: {
                        ...this.getDefaultConfig(),
                        debug_mode: true,
                        log_level: 'DEBUG',
                        enable_profiling: true,
                        hot_reload: true
                    },
                    production: {
                        ...this.getDefaultConfig(),
                        debug_mode: false,
                        log_level: 'WARN',
                        enable_https: true,
                        rate_limiting: true,
                        rate_limit: 500,
                        worker_threads: 8,
                        max_connections: 1000
                    },
                    'claude-desktop': {
                        ...this.getDefaultConfig(),
                        transport: 'stdio',
                        enable_cors: false,
                        log_level: 'WARN'
                    },
                    'wordpress-focused': {
                        ...this.getDefaultConfig(),
                        log_level: 'INFO',
                        max_connections: 50,
                        request_timeout: 60
                    },
                    'high-performance': {
                        ...this.getDefaultConfig(),
                        worker_threads: 16,
                        max_connections: 5000,
                        request_timeout: 10,
                        rate_limit: 10000
                    }
                };
                return templates[type] || templates.default;
            }

            getTemplateName(type) {
                const names = {
                    default: 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š',
                    development: 'é–‹ç™ºç’°å¢ƒ',
                    production: 'æœ¬ç•ªç’°å¢ƒ',
                    'claude-desktop': 'Claude Desktopç”¨',
                    'wordpress-focused': 'WordPressç‰¹åŒ–',
                    'high-performance': 'é«˜æ€§èƒ½è¨­å®š'
                };
                return names[type] || 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š';
            }

            async getCurrentConfigMock() {
                // ãƒ¢ãƒƒã‚¯è¨­å®šãƒ‡ãƒ¼ã‚¿
                return {
                    host: '127.0.0.1',
                    port: 8081,
                    transport: 'HTTP',
                    log_level: 'INFO',
                    debug_mode: false,
                    auto_start: true,
                    enable_cors: true,
                    enable_file_logging: true,
                    log_rotation: false,
                    worker_threads: 4,
                    max_connections: 100,
                    request_timeout: 30,
                    enable_https: false,
                    rate_limiting: true,
                    rate_limit: 1000,
                    enable_metrics: true,
                    enable_profiling: false,
                    metrics_port: 9090,
                    enable_plugins: true,
                    plugin_dir: 'plugins/',
                    hot_reload: true
                };
            }

            async applyConfigMock(config, type) {
                // è¨­å®šé©ç”¨ã®ãƒ¢ãƒƒã‚¯å®Ÿè£…
                await new Promise(resolve => setTimeout(resolve, 1500));
                console.log(`Applied ${type} config:`, config);
            }

            addConfigHistory(type, message) {
                this.configHistory.unshift({
                    type,
                    message,
                    timestamp: new Date().toLocaleString('ja-JP')
                });

                if (this.configHistory.length > 20) {
                    this.configHistory = this.configHistory.slice(0, 20);
                }

                this.updateHistoryDisplay();
            }

            updateHistoryDisplay() {
                const container = document.getElementById('config-history');
                
                if (this.configHistory.length === 0) {
                    container.innerHTML = `
                        <div class="text-center" style="color: #6c757d; padding: 20px;">
                            <p>è¨­å®šå¤‰æ›´å±¥æ­´ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.configHistory.map(op => `
                    <div style="padding: 10px; border-left: 3px solid #28a745; margin-bottom: 10px; background: #f8f9fa;">
                        <strong>${op.type}</strong> - ${op.message}
                        <br><small style="color: #6c757d;">${op.timestamp}</small>
                    </div>
                `).join('');
            }
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            window.serverConfigManager = new ServerConfigManager();
        });
    </script>
</body>
</html>