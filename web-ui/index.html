<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP-RS Web UI - Model Context Protocol Server</title>
    <link rel="stylesheet" href="shared/mcp-ui.css">
</head>
<body>
    <div class="mcp-container mcp-fade-in">
        <header class="mcp-header">
            <h1>ğŸš€ MCP-RS Web UI</h1>
            <p>Model Context Protocol Server - çµ±åˆç®¡ç†ã‚³ãƒ³ã‚½ãƒ¼ãƒ«</p>
        </header>

        <nav class="mcp-nav">
            <ul>
                <li><a href="#" id="nav-home" class="active">ğŸ  ãƒ›ãƒ¼ãƒ </a></li>
                <li><a href="wordpress/dashboard.html" id="nav-wordpress">ğŸ”— WordPressç®¡ç†</a></li>
                <li><a href="admin/config.html" id="nav-config">âš™ï¸ ã‚µãƒ¼ãƒãƒ¼è¨­å®š</a></li>
                <li><a href="admin/transport.html" id="nav-transport">ğŸŒ Transportç®¡ç†</a></li>
                <li><a href="admin/logs.html" id="nav-logs">ğŸ“‹ ãƒ­ã‚°ç®¡ç†</a></li>
            </ul>
        </nav>

        <main class="mcp-main">
            <!-- æ¥ç¶šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
            <div id="connection-status" class="mcp-status info">
                <span class="mcp-loading"></span> MCP-RSã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šä¸­...
            </div>

            <!-- ã‚µãƒ¼ãƒãƒ¼æ¦‚è¦ -->
            <div class="mcp-card mb-3">
                <h3>ğŸ“Š ã‚µãƒ¼ãƒãƒ¼æ¦‚è¦</h3>
                <div id="server-overview" class="mcp-grid cols-3">
                    <div class="mcp-card">
                        <h4>ğŸ”§ ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹</h4>
                        <div id="server-status">æ¥ç¶šä¸­...</div>
                    </div>
                    <div class="mcp-card">
                        <h4>ğŸŒ Transport</h4>
                        <div id="transport-info">ç¢ºèªä¸­...</div>
                    </div>
                    <div class="mcp-card">
                        <h4>ğŸ“ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ³ãƒ‰ãƒ©ãƒ¼</h4>
                        <div id="handler-info">ç¢ºèªä¸­...</div>
                    </div>
                </div>
            </div>

            <!-- ä¸»è¦æ©Ÿèƒ½ -->
            <div class="mcp-grid cols-2">
                <!-- WordPressç®¡ç† -->
                <div class="mcp-card">
                    <h3>ğŸ”— WordPressç®¡ç†</h3>
                    <p>WordPressã‚µã‚¤ãƒˆã®ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ“ä½œã€AIåˆ†ææ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚</p>
                    
                    <div class="mt-2">
                        <a href="wordpress/dashboard.html" class="mcp-btn primary full-width">
                            ğŸ“‚ WordPress ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
                        </a>
                        <a href="wordpress/config.html" class="mcp-btn secondary full-width">
                            âš™ï¸ WordPress è¨­å®š
                        </a>
                    </div>

                    <div class="mt-2 p-2" style="background: #e7f3ff; border-radius: 6px;">
                        <strong>ğŸ’¡ ä¸»è¦æ©Ÿèƒ½:</strong>
                        <ul style="margin: 8px 0 0 20px; color: #0066cc;">
                            <li>ã‚«ãƒ†ã‚´ãƒªãƒ»ã‚¿ã‚°ç®¡ç†</li>
                            <li>è¨˜äº‹ä¸€è¦§ãƒ»è©³ç´°è¡¨ç¤º</li>
                            <li>AI Copiloté€£æºåˆ†æ</li>
                            <li>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿å–å¾—</li>
                        </ul>
                    </div>
                </div>

                <!-- ã‚µãƒ¼ãƒãƒ¼ç®¡ç† -->
                <div class="mcp-card">
                    <h3>âš™ï¸ ã‚µãƒ¼ãƒãƒ¼ç®¡ç†</h3>
                    <p>MCP-RSã‚µãƒ¼ãƒãƒ¼ã®è¨­å®šå¤‰æ›´ã€Transportåˆ‡ã‚Šæ›¿ãˆã€ãƒ­ã‚°ç®¡ç†ã‚’è¡Œã„ã¾ã™ã€‚</p>
                    
                    <div class="mt-2">
                        <a href="admin/config.html" class="mcp-btn primary full-width">
                            ğŸ”§ å‹•çš„è¨­å®šå¤‰æ›´
                        </a>
                        <a href="admin/transport.html" class="mcp-btn secondary full-width">
                            ğŸ”„ Transportåˆ‡ã‚Šæ›¿ãˆ
                        </a>
                        <a href="admin/logs.html" class="mcp-btn secondary full-width">
                            ğŸ“‹ ãƒ­ã‚°ç®¡ç†
                        </a>
                    </div>

                    <div class="mt-2 p-2" style="background: #fff3cd; border-radius: 6px;">
                        <strong>âš¡ å‹•çš„æ©Ÿèƒ½:</strong>
                        <ul style="margin: 8px 0 0 20px; color: #856404;">
                            <li>STDIO â‡„ HTTP åˆ‡ã‚Šæ›¿ãˆ</li>
                            <li>è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å†èª­ã¿è¾¼ã¿</li>
                            <li>ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«å‹•çš„å¤‰æ›´</li>
                            <li>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="mcp-card">
                <h3>ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h3>
                <div class="mcp-grid cols-3">
                    <button class="mcp-btn primary" onclick="quickTest('wordpress')">
                        ğŸ§ª WordPressæ¥ç¶šãƒ†ã‚¹ãƒˆ
                    </button>
                    <button class="mcp-btn secondary" onclick="quickTest('server')">
                        ğŸ“Š ã‚µãƒ¼ãƒãƒ¼æƒ…å ±å–å¾—
                    </button>
                    <button class="mcp-btn warning" onclick="quickReconnect()">
                        ğŸ”„ ã‚µãƒ¼ãƒãƒ¼å†æ¥ç¶š
                    </button>
                </div>
            </div>

            <!-- æœ€è¿‘ã®æ´»å‹• -->
            <div class="mcp-card">
                <h3>ğŸ“ˆ æœ€è¿‘ã®æ´»å‹•</h3>
                <div id="recent-activity">
                    <div class="text-center" style="color: #6c757d; padding: 20px;">
                        <p>ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãƒ­ã‚°ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
                    </div>
                </div>
            </div>
        </main>

        <footer class="mcp-footer">
            <p>
                ğŸš€ MCP-RS v0.15.1 - Model Context Protocol for WordPress | 
                ğŸ’» é–‹ç™ºè€…: <strong>n-takatsu</strong> | 
                ğŸŒ <a href="https://github.com/n-takatsu/mcp-rs">GitHub</a>
            </p>
        </footer>
    </div>

    <script src="shared/mcp-ui.js"></script>
    <script>
        class MCPDashboard {
            constructor() {
                this.client = new MCPClient();
                this.configManager = new MCPConfigManager(this.client);
                this.statusElement = document.getElementById('connection-status');
                this.activities = [];
                
                this.init();
            }

            async init() {
                MCPUIComponents.setActiveNav('nav-home');
                await this.testConnection();
                await this.loadServerOverview();
                await this.loadRecentActivity();
                
                // å®šæœŸæ›´æ–°
                setInterval(() => this.updateStatus(), 30000);
            }

            async testConnection() {
                try {
                    MCPUIComponents.updateStatus(
                        this.statusElement, 
                        'info', 
                        'MCP-RSã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šä¸­...', 
                        true
                    );

                    const result = await this.client.testConnection();
                    
                    MCPUIComponents.updateStatus(
                        this.statusElement, 
                        'success', 
                        'âœ… MCP-RSã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šæ¸ˆã¿ - å…¨æ©Ÿèƒ½åˆ©ç”¨å¯èƒ½'
                    );

                    this.addActivity('æ¥ç¶š', 'ã‚µãƒ¼ãƒãƒ¼ã«æ­£å¸¸æ¥ç¶šã—ã¾ã—ãŸ');
                    
                } catch (error) {
                    MCPUIComponents.updateStatus(
                        this.statusElement, 
                        'error', 
                        `âŒ æ¥ç¶šå¤±æ•—: ${error.message}`
                    );

                    this.addActivity('ã‚¨ãƒ©ãƒ¼', `æ¥ç¶šå¤±æ•—: ${error.message}`);
                    
                    // è‡ªå‹•å†æ¥ç¶šã‚’è©¦è¡Œ
                    setTimeout(() => this.tryReconnect(), 5000);
                }
            }

            async tryReconnect() {
                try {
                    MCPUIComponents.updateStatus(
                        this.statusElement, 
                        'warning', 
                        'ğŸ”„ è‡ªå‹•å†æ¥ç¶šã‚’è©¦è¡Œä¸­...', 
                        true
                    );

                    await this.client.reconnect();
                    
                    MCPUIComponents.updateStatus(
                        this.statusElement, 
                        'success', 
                        'âœ… å†æ¥ç¶šæˆåŠŸ - ã‚µãƒ¼ãƒãƒ¼ãŒåˆ©ç”¨å¯èƒ½ã§ã™'
                    );

                    this.addActivity('å†æ¥ç¶š', 'è‡ªå‹•å†æ¥ç¶šã«æˆåŠŸã—ã¾ã—ãŸ');
                    await this.loadServerOverview();
                    
                } catch (error) {
                    MCPUIComponents.updateStatus(
                        this.statusElement, 
                        'error', 
                        'âŒ å†æ¥ç¶šå¤±æ•— - æ‰‹å‹•ã§ç¢ºèªã—ã¦ãã ã•ã„'
                    );
                }
            }

            async loadServerOverview() {
                if (!this.client.isConnected) return;

                try {
                    // ã‚µãƒ¼ãƒãƒ¼æƒ…å ±å–å¾—
                    const serverInfo = await this.client.getServerInfo();
                    
                    document.getElementById('server-status').innerHTML = `
                        <span style="color: #28a745;">âœ… ç¨¼åƒä¸­</span><br>
                        <small>v${serverInfo.serverInfo?.version || 'Unknown'}</small>
                    `;

                    document.getElementById('transport-info').innerHTML = `
                        <span style="color: #007bff;">ğŸŒ HTTP</span><br>
                        <small>Port: 8081</small>
                    `;

                    document.getElementById('handler-info').innerHTML = `
                        <span style="color: #17a2b8;">ğŸ”— WordPress</span><br>
                        <small>REST API</small>
                    `;

                } catch (error) {
                    console.error('Failed to load server overview:', error);
                }
            }

            async loadRecentActivity() {
                const container = document.getElementById('recent-activity');
                
                if (this.activities.length === 0) {
                    container.innerHTML = `
                        <div class="text-center" style="color: #6c757d; padding: 20px;">
                            <p>ã¾ã ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãŒã‚ã‚Šã¾ã›ã‚“</p>
                            <small>WordPressç®¡ç†ã‚„ã‚µãƒ¼ãƒãƒ¼æ“ä½œã‚’è¡Œã†ã¨å±¥æ­´ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</small>
                        </div>
                    `;
                    return;
                }

                const recentActivities = this.activities.slice(-5).reverse();
                container.innerHTML = recentActivities.map(activity => `
                    <div style="padding: 10px; border-left: 3px solid #4a90e2; margin-bottom: 10px; background: #f8f9fa;">
                        <strong>${activity.type}</strong> - ${activity.message}
                        <br><small style="color: #6c757d;">${activity.timestamp}</small>
                    </div>
                `).join('');
            }

            addActivity(type, message) {
                this.activities.push({
                    type,
                    message,
                    timestamp: new Date().toLocaleString('ja-JP')
                });

                // æœ€æ–°ã®æ´»å‹•ã‚’æ›´æ–°
                this.loadRecentActivity();
            }

            async updateStatus() {
                if (this.client.isConnected) {
                    try {
                        await this.client.makeRequest('ping');
                    } catch (error) {
                        this.client.isConnected = false;
                        MCPUIComponents.updateStatus(
                            this.statusElement, 
                            'warning', 
                            'âš ï¸ æ¥ç¶šãŒå¤±ã‚ã‚Œã¾ã—ãŸ - å†æ¥ç¶šã‚’è©¦è¡Œã—ã¾ã™', 
                            true
                        );
                        setTimeout(() => this.tryReconnect(), 1000);
                    }
                }
            }
        }

        // ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é–¢æ•°
        async function quickTest(type) {
            const dashboard = window.mcpDashboard;
            
            try {
                if (type === 'wordpress') {
                    const result = await dashboard.client.getWordPressResource('categories');
                    dashboard.addActivity('ãƒ†ã‚¹ãƒˆ', 'WordPressæ¥ç¶šãƒ†ã‚¹ãƒˆæˆåŠŸ');
                    
                    MCPUIComponents.showModal(
                        'âœ… WordPressæ¥ç¶šãƒ†ã‚¹ãƒˆæˆåŠŸ',
                        `<p>WordPressã‚µãƒ¼ãƒãƒ¼ã«æ­£å¸¸ã«æ¥ç¶šã§ãã¾ã—ãŸã€‚</p>
                         <p><strong>å–å¾—ãƒ‡ãƒ¼ã‚¿:</strong> ã‚«ãƒ†ã‚´ãƒª ${JSON.parse(result.contents[0].text).length}ä»¶</p>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                    );
                    
                } else if (type === 'server') {
                    const result = await dashboard.client.getServerInfo();
                    dashboard.addActivity('æƒ…å ±å–å¾—', 'ã‚µãƒ¼ãƒãƒ¼æƒ…å ±ã‚’å–å¾—ã—ã¾ã—ãŸ');
                    
                    MCPUIComponents.showModal(
                        'ğŸ“Š ã‚µãƒ¼ãƒãƒ¼æƒ…å ±',
                        `<pre style="background: #f8f9fa; padding: 15px; border-radius: 6px; font-size: 0.9em;">${JSON.stringify(result, null, 2)}</pre>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                    );
                }
                
            } catch (error) {
                dashboard.addActivity('ã‚¨ãƒ©ãƒ¼', `${type}ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
                
                MCPUIComponents.showModal(
                    'âŒ ãƒ†ã‚¹ãƒˆå¤±æ•—',
                    `<p>${error.message}</p>`,
                    [{ text: 'é–‰ã˜ã‚‹', type: 'danger' }]
                );
            }
        }

        async function quickReconnect() {
            const dashboard = window.mcpDashboard;
            dashboard.testConnection();
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            window.mcpDashboard = new MCPDashboard();
        });
    </script>
</body>
</html>