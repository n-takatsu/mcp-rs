<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WordPressç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - MCP-RS Web UI</title>
    <link rel="stylesheet" href="../shared/mcp-ui.css">
</head>
<body>
    <div class="mcp-container mcp-fade-in">
        <header class="mcp-header">
            <h1>ğŸ”— WordPressç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
            <p>WordPressã‚µã‚¤ãƒˆã®ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†ã¨AIåˆ†æ</p>
        </header>

        <nav class="mcp-nav">
            <ul>
                <li><a href="../index.html" id="nav-home">ğŸ  ãƒ›ãƒ¼ãƒ </a></li>
                <li><a href="dashboard.html" id="nav-wordpress" class="active">ğŸ”— WordPressç®¡ç†</a></li>
                <li><a href="config.html" id="nav-wp-config">âš™ï¸ WordPressè¨­å®š</a></li>
                <li><a href="../admin/config.html" id="nav-config">ğŸ”§ ã‚µãƒ¼ãƒãƒ¼è¨­å®š</a></li>
                <li><a href="../admin/transport.html" id="nav-transport">ğŸŒ Transportç®¡ç†</a></li>
                <li><a href="../admin/logs.html" id="nav-logs">ğŸ“‹ ãƒ­ã‚°ç®¡ç†</a></li>
            </ul>
        </nav>

        <main class="mcp-main">
            <!-- æ¥ç¶šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
            <div id="connection-status" class="mcp-status info">
                <span class="mcp-loading"></span> WordPressã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šä¸­...
            </div>

            <div class="mcp-grid cols-2">
                <!-- æ“ä½œãƒ‘ãƒãƒ« -->
                <div class="mcp-card">
                    <h3>ğŸ›ï¸ WordPressæ“ä½œãƒ‘ãƒãƒ«</h3>
                    
                    <div class="mb-2">
                        <h4>ğŸ“‚ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†</h4>
                        <button class="mcp-btn primary full-width" id="get-categories">
                            ğŸ“‚ ã‚«ãƒ†ã‚´ãƒªä¸€è¦§ã‚’å–å¾—
                        </button>
                        <button class="mcp-btn primary full-width" id="get-tags">
                            ğŸ·ï¸ ã‚¿ã‚°ä¸€è¦§ã‚’å–å¾—
                        </button>
                        <button class="mcp-btn primary full-width" id="get-posts">
                            ğŸ“ è¨˜äº‹ä¸€è¦§ã‚’å–å¾—
                        </button>
                        <button class="mcp-btn secondary full-width" id="get-media">
                            ğŸ–¼ï¸ ãƒ¡ãƒ‡ã‚£ã‚¢ä¸€è¦§ã‚’å–å¾—
                        </button>
                    </div>

                    <div class="mb-2">
                        <h4>ğŸ¤– AIåˆ†ææ©Ÿèƒ½</h4>
                        <button class="mcp-btn warning full-width" id="copilot-analysis" disabled>
                            ğŸ¤– Copilotè©³ç´°åˆ†æ
                        </button>
                        <button class="mcp-btn secondary full-width" id="export-data" disabled>
                            ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                        </button>
                    </div>

                    <div class="mb-2">
                        <h4>âš™ï¸ æ¥ç¶šè¨­å®š</h4>
                        <input type="text" class="mcp-input" id="server-url" 
                               value="http://127.0.0.1:8081/mcp" 
                               placeholder="MCP-RSã‚µãƒ¼ãƒãƒ¼URL">
                        <button class="mcp-btn secondary full-width" id="reconnect">
                            ğŸ”„ å†æ¥ç¶š
                        </button>
                        <button class="mcp-btn primary full-width" id="test-connection">
                            ğŸ§ª æ¥ç¶šãƒ†ã‚¹ãƒˆ
                        </button>
                    </div>
                </div>

                <!-- çµæœè¡¨ç¤ºãƒ‘ãƒãƒ« -->
                <div class="mcp-card">
                    <h3>ğŸ“Š å®Ÿè¡Œçµæœ</h3>
                    <div id="response-area" class="mcp-result">
WordPressãƒ‡ãƒ¼ã‚¿ã®å–å¾—çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...

ğŸ’¡ ä½¿ã„æ–¹ï¼š
1. å·¦ã®æ“ä½œãƒ‘ãƒãƒ«ã§ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. WordPressãƒ‡ãƒ¼ã‚¿ãŒè‡ªå‹•å–å¾—ã•ã‚Œã‚‹
3. AIåˆ†ææ©Ÿèƒ½ã§Copilotã«é€£æº

ğŸ¯ ä¸»ãªæ©Ÿèƒ½ï¼š
â€¢ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿å–å¾—
â€¢ JSONå½¢å¼ã§ã®è©³ç´°è¡¨ç¤º  
â€¢ AI Copiloté€£æºåˆ†æ
â€¢ ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½
                    </div>
                </div>
            </div>

            <!-- è©³ç´°åˆ†æã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="mcp-card">
                <h3>ğŸ“ˆ WordPressã‚µã‚¤ãƒˆåˆ†æ</h3>
                <div id="analysis-section">
                    <div class="mcp-grid cols-3">
                        <div class="mcp-card">
                            <h4>ğŸ“Š çµ±è¨ˆæƒ…å ±</h4>
                            <div id="stats-info">
                                <p style="color: #6c757d;">ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦çµ±è¨ˆã‚’è¡¨ç¤º</p>
                            </div>
                        </div>
                        <div class="mcp-card">
                            <h4>ğŸ—ï¸ ã‚µã‚¤ãƒˆæ§‹é€ </h4>
                            <div id="structure-info">
                                <p style="color: #6c757d;">ã‚«ãƒ†ã‚´ãƒªãƒ»ã‚¿ã‚°æ§‹é€ ã‚’åˆ†æ</p>
                            </div>
                        </div>
                        <div class="mcp-card">
                            <h4>ğŸ“ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å“è³ª</h4>
                            <div id="quality-info">
                                <p style="color: #6c757d;">è¨˜äº‹ã®å“è³ªæŒ‡æ¨™ã‚’åˆ†æ</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æœ€è¿‘ã®æ“ä½œå±¥æ­´ -->
            <div class="mcp-card">
                <h3>ğŸ“‹ æœ€è¿‘ã®æ“ä½œå±¥æ­´</h3>
                <div id="operation-history">
                    <div class="text-center" style="color: #6c757d; padding: 20px;">
                        <p>æ“ä½œå±¥æ­´ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
                    </div>
                </div>
            </div>
        </main>

        <footer class="mcp-footer">
            <p>
                ğŸš€ MCP-RS v0.16.0 - WordPress Management Dashboard | 
                ğŸ’» é–‹ç™ºè€…: <strong>n-takatsu</strong> | 
                ğŸŒ <a href="https://github.com/n-takatsu/mcp-rs">GitHub</a>
            </p>
        </footer>
    </div>

    <script src="../shared/mcp-ui.js"></script>
    <script>
        class WordPressDashboard {
            constructor() {
                this.client = new MCPClient();
                this.statusElement = document.getElementById('connection-status');
                this.responseArea = document.getElementById('response-area');
                this.serverUrlInput = document.getElementById('server-url');
                this.lastResponseData = null;
                this.lastResponseTitle = null;
                this.operationHistory = [];
                
                this.initializeElements();
                this.bindEvents();
                this.testConnection();
            }

            initializeElements() {
                this.buttons = {
                    categories: document.getElementById('get-categories'),
                    tags: document.getElementById('get-tags'),
                    posts: document.getElementById('get-posts'),
                    media: document.getElementById('get-media'),
                    copilotAnalysis: document.getElementById('copilot-analysis'),
                    exportData: document.getElementById('export-data'),
                    reconnect: document.getElementById('reconnect'),
                    testConnection: document.getElementById('test-connection')
                };

                // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
                MCPUIComponents.setActiveNav('nav-wordpress');
            }

            bindEvents() {
                this.buttons.categories.addEventListener('click', () => this.getCategories());
                this.buttons.tags.addEventListener('click', () => this.getTags());
                this.buttons.posts.addEventListener('click', () => this.getPosts());
                this.buttons.media.addEventListener('click', () => this.getMedia());
                this.buttons.copilotAnalysis.addEventListener('click', () => this.exportToCopilot());
                this.buttons.exportData.addEventListener('click', () => this.exportData());
                this.buttons.reconnect.addEventListener('click', () => this.reconnect());
                this.buttons.testConnection.addEventListener('click', () => this.testConnection());
            }

            async testConnection() {
                try {
                    MCPUIComponents.updateStatus(
                        this.statusElement, 
                        'info', 
                        'WordPressã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šä¸­...', 
                        true
                    );

                    const result = await this.client.testConnection();
                    this.setConnected(true);
                    
                    // WordPressæ¥ç¶šãƒ†ã‚¹ãƒˆ
                    await this.client.getWordPressResource('categories');
                    
                    MCPUIComponents.updateStatus(
                        this.statusElement, 
                        'success', 
                        'âœ… WordPressã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šæ¸ˆã¿ - å…¨æ©Ÿèƒ½åˆ©ç”¨å¯èƒ½'
                    );

                    this.addOperationHistory('æ¥ç¶š', 'WordPressã‚µãƒ¼ãƒãƒ¼ã«æ­£å¸¸æ¥ç¶š');
                    
                } catch (error) {
                    this.setConnected(false);
                    MCPUIComponents.showError(this.responseArea, `æ¥ç¶šå¤±æ•—: ${error.message}`);
                    this.addOperationHistory('ã‚¨ãƒ©ãƒ¼', `æ¥ç¶šå¤±æ•—: ${error.message}`);
                }
            }

            setConnected(connected) {
                this.client.isConnected = connected;
                
                Object.values(this.buttons).forEach(btn => {
                    if (btn.id !== 'reconnect' && btn.id !== 'test-connection') {
                        btn.disabled = !connected;
                    }
                });

                if (connected) {
                    MCPUIComponents.updateStatus(
                        this.statusElement, 
                        'success', 
                        'âœ… WordPressã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šæ¸ˆã¿'
                    );
                } else {
                    MCPUIComponents.updateStatus(
                        this.statusElement, 
                        'error', 
                        'âŒ WordPressã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“'
                    );
                }
            }

            async getCategories() {
                MCPUIComponents.showLoading(this.responseArea, 'ã‚«ãƒ†ã‚´ãƒªã‚’å–å¾—ä¸­...');
                try {
                    const result = await this.client.getWordPressResource('categories');
                    MCPUIComponents.showResult(this.responseArea, 'ğŸ“‚ WordPressã‚«ãƒ†ã‚´ãƒªä¸€è¦§', result);
                    
                    this.lastResponseData = result;
                    this.lastResponseTitle = 'ğŸ“‚ WordPressã‚«ãƒ†ã‚´ãƒªä¸€è¦§';
                    this.enableAnalysisButtons();
                    this.updateSiteAnalysis('categories', result);
                    this.addOperationHistory('å–å¾—', 'ã‚«ãƒ†ã‚´ãƒªä¸€è¦§ã‚’å–å¾—ã—ã¾ã—ãŸ');
                    
                } catch (error) {
                    MCPUIComponents.showError(this.responseArea, `ã‚«ãƒ†ã‚´ãƒªå–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    this.addOperationHistory('ã‚¨ãƒ©ãƒ¼', `ã‚«ãƒ†ã‚´ãƒªå–å¾—å¤±æ•—: ${error.message}`);
                }
            }

            async getTags() {
                MCPUIComponents.showLoading(this.responseArea, 'ã‚¿ã‚°ã‚’å–å¾—ä¸­...');
                try {
                    const result = await this.client.getWordPressResource('tags');
                    MCPUIComponents.showResult(this.responseArea, 'ğŸ·ï¸ WordPressã‚¿ã‚°ä¸€è¦§', result);
                    
                    this.lastResponseData = result;
                    this.lastResponseTitle = 'ğŸ·ï¸ WordPressã‚¿ã‚°ä¸€è¦§';
                    this.enableAnalysisButtons();
                    this.updateSiteAnalysis('tags', result);
                    this.addOperationHistory('å–å¾—', 'ã‚¿ã‚°ä¸€è¦§ã‚’å–å¾—ã—ã¾ã—ãŸ');
                    
                } catch (error) {
                    MCPUIComponents.showError(this.responseArea, `ã‚¿ã‚°å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    this.addOperationHistory('ã‚¨ãƒ©ãƒ¼', `ã‚¿ã‚°å–å¾—å¤±æ•—: ${error.message}`);
                }
            }

            async getPosts() {
                MCPUIComponents.showLoading(this.responseArea, 'è¨˜äº‹ã‚’å–å¾—ä¸­...');
                try {
                    const result = await this.client.getWordPressResource('posts');
                    MCPUIComponents.showResult(this.responseArea, 'ğŸ“ WordPressè¨˜äº‹ä¸€è¦§', result);
                    
                    this.lastResponseData = result;
                    this.lastResponseTitle = 'ğŸ“ WordPressè¨˜äº‹ä¸€è¦§';
                    this.enableAnalysisButtons();
                    this.updateSiteAnalysis('posts', result);
                    this.addOperationHistory('å–å¾—', 'è¨˜äº‹ä¸€è¦§ã‚’å–å¾—ã—ã¾ã—ãŸ');
                    
                } catch (error) {
                    MCPUIComponents.showError(this.responseArea, `è¨˜äº‹å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    this.addOperationHistory('ã‚¨ãƒ©ãƒ¼', `è¨˜äº‹å–å¾—å¤±æ•—: ${error.message}`);
                }
            }

            async getMedia() {
                MCPUIComponents.showLoading(this.responseArea, 'ãƒ¡ãƒ‡ã‚£ã‚¢ã‚’å–å¾—ä¸­...');
                try {
                    const result = await this.client.getWordPressResource('media');
                    MCPUIComponents.showResult(this.responseArea, 'ğŸ–¼ï¸ WordPressãƒ¡ãƒ‡ã‚£ã‚¢ä¸€è¦§', result);
                    
                    this.lastResponseData = result;
                    this.lastResponseTitle = 'ğŸ–¼ï¸ WordPressãƒ¡ãƒ‡ã‚£ã‚¢ä¸€è¦§';
                    this.enableAnalysisButtons();
                    this.addOperationHistory('å–å¾—', 'ãƒ¡ãƒ‡ã‚£ã‚¢ä¸€è¦§ã‚’å–å¾—ã—ã¾ã—ãŸ');
                    
                } catch (error) {
                    MCPUIComponents.showError(this.responseArea, `ãƒ¡ãƒ‡ã‚£ã‚¢å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    this.addOperationHistory('ã‚¨ãƒ©ãƒ¼', `ãƒ¡ãƒ‡ã‚£ã‚¢å–å¾—å¤±æ•—: ${error.message}`);
                }
            }

            enableAnalysisButtons() {
                this.buttons.copilotAnalysis.disabled = false;
                this.buttons.exportData.disabled = false;
            }

            async exportToCopilot() {
                if (!this.lastResponseData) {
                    MCPUIComponents.showError(this.responseArea, 'ã¾ãšWordPressãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãã ã•ã„');
                    return;
                }

                const analysisPrompt = this.generateCopilotPrompt();
                const analysisContent = `# WordPress ãƒ‡ãƒ¼ã‚¿åˆ†æ - Copilotç”¨

## ğŸ“‹ åˆ†æå¯¾è±¡ãƒ‡ãƒ¼ã‚¿
${this.lastResponseTitle}
å–å¾—æ™‚åˆ»: ${new Date().toLocaleString('ja-JP')}

## ğŸ¤– Copilotåˆ†æãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
${analysisPrompt}

## ğŸ“Š ç”Ÿãƒ‡ãƒ¼ã‚¿ (JSON)
\`\`\`json
${JSON.stringify(this.lastResponseData, null, 2)}
\`\`\`

## ğŸ’¡ Copilot ã«èãã¹ãè³ªå•ä¾‹:
1. "ã“ã®WordPressã‚µã‚¤ãƒˆã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æˆ¦ç•¥ã‚’åˆ†æã—ã¦ãã ã•ã„"
2. "ã‚«ãƒ†ã‚´ãƒªæ§‹é€ ã®æ”¹å–„æ¡ˆã‚’ææ¡ˆã—ã¦ãã ã•ã„"  
3. "SEOè¦³ç‚¹ã§ã®èª²é¡Œã¨æ”¹å–„ç‚¹ã‚’æ•™ãˆã¦ãã ã•ã„"
4. "ã“ã®ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰èª­ã¿å–ã‚Œã‚‹ã‚µã‚¤ãƒˆé‹å–¶ã®ç‰¹å¾´ã¯ï¼Ÿ"
5. "ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã®è¦³ç‚¹ã§ã®åˆ†æã‚’ãŠé¡˜ã„ã—ã¾ã™"

---
ğŸ’» ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’VS Codeã§é–‹ã„ã¦ã€Copilotã«ä¸Šè¨˜ã®è³ªå•ã‚’æŠ•ã’ã¦ãã ã•ã„ï¼
`;

                MCPUIComponents.downloadFile(analysisContent, 'wordpress-analysis-for-copilot.md', 'text/markdown');
                
                MCPUIComponents.showModal(
                    'ğŸ¤– Copilotåˆ†æãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆå®Œäº†',
                    `<p><strong>wordpress-analysis-for-copilot.md</strong> ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã—ãŸï¼</p>
                     <ol style="margin: 15px 0 0 20px;">
                        <li>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’VS Codeã§é–‹ã</li>
                        <li>GitHub Copilotã«è³ªå•ã‚’æŠ•ã’ã‚‹</li>
                        <li>ã‚ˆã‚Šè©³ç´°ãªåˆ†æã‚’å–å¾—ã™ã‚‹</li>
                     </ol>`,
                    [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                );

                this.addOperationHistory('åˆ†æ', 'Copilotåˆ†æãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸ');
            }

            async exportData() {
                if (!this.lastResponseData) {
                    MCPUIComponents.showError(this.responseArea, 'ã¾ãšWordPressãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãã ã•ã„');
                    return;
                }

                const exportData = {
                    title: this.lastResponseTitle,
                    timestamp: new Date().toISOString(),
                    data: this.lastResponseData
                };

                MCPUIComponents.downloadFile(
                    JSON.stringify(exportData, null, 2), 
                    `wordpress-export-${Date.now()}.json`, 
                    'application/json'
                );

                this.addOperationHistory('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ', 'ãƒ‡ãƒ¼ã‚¿ã‚’JSONãƒ•ã‚¡ã‚¤ãƒ«ã§å‡ºåŠ›ã—ã¾ã—ãŸ');
            }

            generateCopilotPrompt() {
                if (this.lastResponseTitle.includes('ã‚«ãƒ†ã‚´ãƒª')) {
                    return `ä»¥ä¸‹ã¯WordPressã‚µã‚¤ãƒˆã®ã‚«ãƒ†ã‚´ãƒªãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã¦ã€ã‚µã‚¤ãƒˆã®æ§‹é€ ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æˆ¦ç•¥ã€SEOè¦³ç‚¹ã§ã®è©•ä¾¡ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚ç‰¹ã«éšå±¤æ§‹é€ ã€å‘½åè¦å‰‡ã€èª¬æ˜æ–‡ã®å“è³ªã«ã¤ã„ã¦è©³ã—ãåˆ†æã—ã¦ãã ã•ã„ã€‚`;
                } else if (this.lastResponseTitle.includes('ã‚¿ã‚°')) {
                    return `ä»¥ä¸‹ã¯WordPressã‚µã‚¤ãƒˆã®ã‚¿ã‚°ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚ã‚¿ã‚°ä»˜ã‘æˆ¦ç•¥ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åˆ†é¡ã®åŠ¹ç‡æ€§ã€SEOåŠ¹æœã«ã¤ã„ã¦åˆ†æã—ã¦ãã ã•ã„ã€‚`;
                } else if (this.lastResponseTitle.includes('è¨˜äº‹')) {
                    return `ä»¥ä¸‹ã¯WordPressã‚µã‚¤ãƒˆã®è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚å…¬é–‹é »åº¦ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å“è³ªã€ã‚«ãƒ†ã‚´ãƒªåˆ†æ•£ã€æ›´æ–°ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¤ã„ã¦åˆ†æã—ã¦ãã ã•ã„ã€‚`;
                }
                return `ä»¥ä¸‹ã®WordPressãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã¦ã€ã‚µã‚¤ãƒˆé‹å–¶ã®ç‰¹å¾´ã¨æ”¹å–„ç‚¹ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚`;
            }

            updateSiteAnalysis(type, data) {
                try {
                    if (type === 'categories') {
                        const categories = JSON.parse(data.contents[0].text);
                        document.getElementById('stats-info').innerHTML = `
                            <p><strong>ã‚«ãƒ†ã‚´ãƒªæ•°:</strong> ${categories.length}</p>
                            <p><strong>éšå±¤ã‚ã‚Š:</strong> ${categories.some(c => c.parent !== 0) ? 'Yes' : 'No'}</p>
                        `;
                        document.getElementById('structure-info').innerHTML = `
                            <p><strong>æœ€å¤§éšå±¤:</strong> ${this.calculateMaxDepth(categories)}</p>
                            <p><strong>èª¬æ˜ä»˜ã:</strong> ${categories.filter(c => c.description).length}/${categories.length}</p>
                        `;
                    } else if (type === 'posts') {
                        const posts = JSON.parse(data.contents[0].text);
                        document.getElementById('stats-info').innerHTML = `
                            <p><strong>è¨˜äº‹æ•°:</strong> ${posts.length}</p>
                            <p><strong>å…¬é–‹æ¸ˆã¿:</strong> ${posts.filter(p => p.status === 'publish').length}</p>
                        `;
                        document.getElementById('quality-info').innerHTML = `
                            <p><strong>å¹³å‡æ–‡å­—æ•°:</strong> ${this.calculateAvgLength(posts)}</p>
                            <p><strong>æœ€æ–°è¨˜äº‹:</strong> ${posts[0]?.title?.rendered || 'N/A'}</p>
                        `;
                    }
                } catch (error) {
                    console.error('Failed to update site analysis:', error);
                }
            }

            calculateMaxDepth(categories) {
                // ã‚«ãƒ†ã‚´ãƒªã®æœ€å¤§éšå±¤æ·±åº¦ã‚’è¨ˆç®—
                let maxDepth = 1;
                for (const cat of categories) {
                    if (cat.parent !== 0) {
                        maxDepth = Math.max(maxDepth, 2); // ç°¡æ˜“å®Ÿè£…
                    }
                }
                return maxDepth;
            }

            calculateAvgLength(posts) {
                if (posts.length === 0) return 0;
                const totalLength = posts.reduce((sum, post) => {
                    const content = post.content?.rendered || '';
                    return sum + content.replace(/<[^>]*>/g, '').length;
                }, 0);
                return Math.round(totalLength / posts.length);
            }

            reconnect() {
                this.client.serverUrl = this.serverUrlInput.value;
                this.testConnection();
            }

            addOperationHistory(type, message) {
                this.operationHistory.unshift({
                    type,
                    message,
                    timestamp: new Date().toLocaleString('ja-JP')
                });

                // æœ€å¤§10ä»¶ã¾ã§ä¿æŒ
                if (this.operationHistory.length > 10) {
                    this.operationHistory = this.operationHistory.slice(0, 10);
                }

                this.updateHistoryDisplay();
            }

            updateHistoryDisplay() {
                const container = document.getElementById('operation-history');
                
                if (this.operationHistory.length === 0) {
                    container.innerHTML = `
                        <div class="text-center" style="color: #6c757d; padding: 20px;">
                            <p>æ“ä½œå±¥æ­´ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.operationHistory.map(op => `
                    <div style="padding: 10px; border-left: 3px solid #28a745; margin-bottom: 10px; background: #f8f9fa;">
                        <strong>${op.type}</strong> - ${op.message}
                        <br><small style="color: #6c757d;">${op.timestamp}</small>
                    </div>
                `).join('');
            }
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            window.wordpressDashboard = new WordPressDashboard();
        });
    </script>
</body>
</html>