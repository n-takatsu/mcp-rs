<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WordPressè¨­å®šç®¡ç† - MCP-RS Web UI</title>
    <link rel="stylesheet" href="../shared/mcp-ui.css">
</head>
<body>
    <div class="mcp-container mcp-fade-in">
        <header class="mcp-header">
            <h1>âš™ï¸ WordPressè¨­å®šç®¡ç†</h1>
            <p>WordPressæ¥ç¶šè¨­å®šã¨MCPã‚µãƒ¼ãƒãƒ¼è¨­å®šã®å‹•çš„å¤‰æ›´</p>
        </header>

        <nav class="mcp-nav">
            <ul>
                <li><a href="../index.html" id="nav-home">ğŸ  ãƒ›ãƒ¼ãƒ </a></li>
                <li><a href="dashboard.html" id="nav-wordpress">ğŸ”— WordPressç®¡ç†</a></li>
                <li><a href="config.html" id="nav-wp-config" class="active">âš™ï¸ WordPressè¨­å®š</a></li>
                <li><a href="../admin/config.html" id="nav-config">ğŸ”§ ã‚µãƒ¼ãƒãƒ¼è¨­å®š</a></li>
                <li><a href="../admin/transport.html" id="nav-transport">ğŸŒ Transportç®¡ç†</a></li>
                <li><a href="../admin/logs.html" id="nav-logs">ğŸ“‹ ãƒ­ã‚°ç®¡ç†</a></li>
            </ul>
        </nav>

        <main class="mcp-main">
            <!-- æ¥ç¶šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
            <div id="connection-status" class="mcp-status info">
                <span class="mcp-loading"></span> MCP-RSã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šä¸­...
            </div>

            <div class="mcp-grid cols-2">
                <!-- WordPressæ¥ç¶šè¨­å®š -->
                <div class="mcp-card">
                    <h3>ğŸ”— WordPressæ¥ç¶šè¨­å®š</h3>
                    
                    <form id="wordpress-config-form">
                        <div class="mb-2">
                            <label for="wp-url"><strong>WordPressã‚µã‚¤ãƒˆURL</strong></label>
                            <input type="url" class="mcp-input" id="wp-url" 
                                   placeholder="https://your-wordpress-site.com" required>
                            <small style="color: #6c757d;">REST API ãŒæœ‰åŠ¹ãªWordPressã‚µã‚¤ãƒˆã®URL</small>
                        </div>

                        <div class="mb-2">
                            <label for="wp-username"><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼å</strong></label>
                            <input type="text" class="mcp-input" id="wp-username" 
                                   placeholder="WordPressç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼å" required>
                        </div>

                        <div class="mb-2">
                            <label for="wp-password"><strong>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</strong></label>
                            <input type="password" class="mcp-input" id="wp-password" 
                                   placeholder="WordPressã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" required>
                            <small style="color: #6c757d;">
                                WordPressç®¡ç†ç”»é¢ã®ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ > ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã€ã§ç”Ÿæˆ
                            </small>
                        </div>

                        <div class="mb-2">
                            <label for="wp-timeout"><strong>ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ (ç§’)</strong></label>
                            <input type="number" class="mcp-input" id="wp-timeout" 
                                   value="30" min="5" max="300">
                        </div>

                        <div class="mb-2">
                            <label for="wp-cache-ttl"><strong>ã‚­ãƒ£ãƒƒã‚·ãƒ¥TTL (ç§’)</strong></label>
                            <input type="number" class="mcp-input" id="wp-cache-ttl" 
                                   value="300" min="0" max="3600">
                        </div>

                        <div class="mb-2">
                            <label>
                                <input type="checkbox" id="wp-enabled" checked>
                                <strong>WordPressçµ±åˆã‚’æœ‰åŠ¹åŒ–</strong>
                            </label>
                        </div>

                        <div class="mt-2">
                            <button type="submit" class="mcp-btn primary full-width">
                                ğŸ’¾ è¨­å®šã‚’ä¿å­˜ãƒ»é©ç”¨
                            </button>
                            <button type="button" class="mcp-btn secondary full-width" id="test-wp-connection">
                                ğŸ§ª WordPressæ¥ç¶šãƒ†ã‚¹ãƒˆ
                            </button>
                            <button type="button" class="mcp-btn warning full-width" id="load-current-config">
                                ğŸ“‹ ç¾åœ¨ã®è¨­å®šã‚’èª­ã¿è¾¼ã¿
                            </button>
                        </div>
                    </form>
                </div>

                <!-- MCPã‚µãƒ¼ãƒãƒ¼è¨­å®š -->
                <div class="mcp-card">
                    <h3>ğŸ”§ MCPã‚µãƒ¼ãƒãƒ¼è¨­å®š</h3>
                    
                    <div class="mb-2">
                        <h4>ğŸŒ Transportè¨­å®š</h4>
                        <select class="mcp-input" id="transport-type">
                            <option value="stdio">STDIO (Claude Desktopç”¨)</option>
                            <option value="http" selected>HTTP (Web UIç”¨)</option>
                            <option value="websocket">WebSocket (å°†æ¥å®Ÿè£…)</option>
                        </select>
                        
                        <div id="http-settings">
                            <label for="http-port"><strong>HTTPãƒãƒ¼ãƒˆ</strong></label>
                            <input type="number" class="mcp-input" id="http-port" 
                                   value="8081" min="1024" max="65535">
                        </div>
                    </div>

                    <div class="mb-2">
                        <h4>ğŸ“‹ ãƒ­ã‚°è¨­å®š</h4>
                        <label for="log-level"><strong>ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«</strong></label>
                        <select class="mcp-input" id="log-level">
                            <option value="trace">TRACE (æœ€è©³ç´°)</option>
                            <option value="debug">DEBUG (ãƒ‡ãƒãƒƒã‚°)</option>
                            <option value="info" selected>INFO (æ¨™æº–)</option>
                            <option value="warn">WARN (è­¦å‘Šã®ã¿)</option>
                            <option value="error">ERROR (ã‚¨ãƒ©ãƒ¼ã®ã¿)</option>
                        </select>
                    </div>

                    <div class="mb-2">
                        <h4>ğŸ”„ å‹•çš„åˆ¶å¾¡</h4>
                        <button class="mcp-btn secondary full-width" id="reload-config">
                            ğŸ”„ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å†èª­ã¿è¾¼ã¿
                        </button>
                        <button class="mcp-btn warning full-width" id="switch-transport">
                            ğŸŒ Transportåˆ‡ã‚Šæ›¿ãˆ
                        </button>
                        <button class="mcp-btn primary full-width" id="apply-log-level">
                            ğŸ“‹ ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«é©ç”¨
                        </button>
                    </div>

                    <div class="mb-2">
                        <h4>ğŸ“Š ã‚µãƒ¼ãƒãƒ¼åˆ¶å¾¡</h4>
                        <button class="mcp-btn danger full-width" id="restart-server">
                            âš ï¸ ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•
                        </button>
                    </div>
                </div>
            </div>

            <!-- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
            <div class="mcp-card">
                <h3>ğŸ“„ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
                <div class="mb-2">
                    <label for="config-template"><strong>è¨­å®šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ</strong></label>
                    <select class="mcp-input" id="config-template">
                        <option value="claude-desktop">Claude Desktopç”¨ (STDIO)</option>
                        <option value="web-ui" selected>Web UIç”¨ (HTTP)</option>
                        <option value="production">æœ¬ç•ªç”¨ (å®Œå…¨è¨­å®š)</option>
                        <option value="development">é–‹ç™ºç”¨</option>
                    </select>
                </div>
                
                <div id="config-preview" class="mcp-result">
# ç”Ÿæˆã•ã‚ŒãŸè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
# ã€Œè¨­å®šã‚’ä¿å­˜ãƒ»é©ç”¨ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨è¨­å®šãŒç”Ÿæˆãƒ»é©ç”¨ã•ã‚Œã¾ã™
                </div>

                <div class="mt-2">
                    <button class="mcp-btn secondary" id="copy-config">
                        ğŸ“‹ è¨­å®šã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
                    </button>
                    <button class="mcp-btn secondary" id="download-config">
                        ğŸ’¾ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                    </button>
                    <button class="mcp-btn primary" id="preview-config">
                        ğŸ‘€ è¨­å®šãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆ
                    </button>
                </div>
            </div>

            <!-- æ“ä½œãƒ­ã‚° -->
            <div class="mcp-card">
                <h3>ğŸ“‹ æ“ä½œãƒ­ã‚°</h3>
                <div id="operation-log">
                    <div class="text-center" style="color: #6c757d; padding: 20px;">
                        <p>è¨­å®šå¤‰æ›´ã®æ“ä½œãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
                    </div>
                </div>
            </div>
        </main>

        <footer class="mcp-footer">
            <p>
                ğŸš€ MCP-RS v0.15.1 - WordPress Configuration Management | 
                ğŸ’» é–‹ç™ºè€…: <strong>n-takatsu</strong> | 
                ğŸŒ <a href="https://github.com/n-takatsu/mcp-rs">GitHub</a>
            </p>
        </footer>
    </div>

    <script src="../shared/mcp-ui.js"></script>
    <script>
        class WordPressConfigManager {
            constructor() {
                this.client = new MCPClient();
                this.configManager = new MCPConfigManager(this.client);
                this.statusElement = document.getElementById('connection-status');
                this.operationLog = [];
                
                this.initializeElements();
                this.bindEvents();
                this.testConnection();
            }

            initializeElements() {
                // ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ 
                this.form = document.getElementById('wordpress-config-form');
                this.wpUrl = document.getElementById('wp-url');
                this.wpUsername = document.getElementById('wp-username');
                this.wpPassword = document.getElementById('wp-password');
                this.wpTimeout = document.getElementById('wp-timeout');
                this.wpCacheTtl = document.getElementById('wp-cache-ttl');
                this.wpEnabled = document.getElementById('wp-enabled');

                // ã‚µãƒ¼ãƒãƒ¼è¨­å®šè¦ç´ 
                this.transportType = document.getElementById('transport-type');
                this.httpPort = document.getElementById('http-port');
                this.logLevel = document.getElementById('log-level');
                this.configTemplate = document.getElementById('config-template');
                this.configPreview = document.getElementById('config-preview');

                // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
                MCPUIComponents.setActiveNav('nav-wp-config');
            }

            bindEvents() {
                // WordPressè¨­å®šãƒ•ã‚©ãƒ¼ãƒ 
                this.form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveWordPressConfig();
                });

                // ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
                document.getElementById('test-wp-connection').addEventListener('click', () => this.testWordPressConnection());
                document.getElementById('load-current-config').addEventListener('click', () => this.loadCurrentConfig());
                document.getElementById('reload-config').addEventListener('click', () => this.reloadConfig());
                document.getElementById('switch-transport').addEventListener('click', () => this.switchTransport());
                document.getElementById('apply-log-level').addEventListener('click', () => this.applyLogLevel());
                document.getElementById('restart-server').addEventListener('click', () => this.restartServer());
                document.getElementById('copy-config').addEventListener('click', () => this.copyConfig());
                document.getElementById('download-config').addEventListener('click', () => this.downloadConfig());
                document.getElementById('preview-config').addEventListener('click', () => this.previewConfig());

                // Transportåˆ‡ã‚Šæ›¿ãˆæ™‚ã®è¨­å®šè¡¨ç¤º
                this.transportType.addEventListener('change', () => this.updateTransportSettings());
            }

            async testConnection() {
                try {
                    MCPUIComponents.updateStatus(
                        this.statusElement, 
                        'info', 
                        'MCP-RSã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šä¸­...', 
                        true
                    );

                    await this.client.testConnection();
                    
                    MCPUIComponents.updateStatus(
                        this.statusElement, 
                        'success', 
                        'âœ… MCP-RSã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šæ¸ˆã¿ - è¨­å®šå¤‰æ›´æ©Ÿèƒ½åˆ©ç”¨å¯èƒ½'
                    );

                    this.addOperationLog('æ¥ç¶š', 'MCPã‚µãƒ¼ãƒãƒ¼ã«æ­£å¸¸æ¥ç¶šã—ã¾ã—ãŸ');
                    
                } catch (error) {
                    MCPUIComponents.updateStatus(
                        this.statusElement, 
                        'error', 
                        `âŒ æ¥ç¶šå¤±æ•—: ${error.message}`
                    );

                    this.addOperationLog('ã‚¨ãƒ©ãƒ¼', `æ¥ç¶šå¤±æ•—: ${error.message}`);
                }
            }

            async loadCurrentConfig() {
                try {
                    this.addOperationLog('è¨­å®šå–å¾—', 'ç¾åœ¨ã®è¨­å®šã‚’èª­ã¿è¾¼ã¿ä¸­...');
                    
                    // ç¾åœ¨ã®è¨­å®šã‚’å–å¾—ï¼ˆãƒ¢ãƒƒã‚¯å®Ÿè£…ï¼‰
                    const config = await this.getCurrentConfigMock();
                    
                    if (config.handlers?.wordpress) {
                        const wp = config.handlers.wordpress;
                        this.wpUrl.value = wp.url || '';
                        this.wpUsername.value = wp.username || '';
                        this.wpPassword.value = wp.password || '';
                        this.wpTimeout.value = wp.timeout || 30;
                        this.wpCacheTtl.value = wp.cache_ttl || 300;
                        this.wpEnabled.checked = wp.enabled !== false;
                    }

                    if (config.server) {
                        this.logLevel.value = config.server.log_level || 'info';
                    }

                    if (config.transport) {
                        this.transportType.value = config.transport.transport_type || 'http';
                        if (config.transport.http?.port) {
                            this.httpPort.value = config.transport.http.port;
                        }
                    }

                    this.updateTransportSettings();
                    this.addOperationLog('è¨­å®šå–å¾—', 'ç¾åœ¨ã®è¨­å®šã‚’æ­£å¸¸ã«èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
                    
                } catch (error) {
                    this.addOperationLog('ã‚¨ãƒ©ãƒ¼', `è¨­å®šèª­ã¿è¾¼ã¿å¤±æ•—: ${error.message}`);
                    MCPUIComponents.showModal(
                        'âš ï¸ è¨­å®šèª­ã¿è¾¼ã¿å¤±æ•—',
                        `<p>ç¾åœ¨ã®è¨­å®šã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚</p><p>${error.message}</p>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'warning' }]
                    );
                }
            }

            async saveWordPressConfig() {
                try {
                    const config = this.generateConfig();
                    
                    this.addOperationLog('è¨­å®šä¿å­˜', 'è¨­å®šã‚’ä¿å­˜ãƒ»é©ç”¨ä¸­...');
                    
                    // è¨­å®šä¿å­˜ï¼ˆãƒ¢ãƒƒã‚¯å®Ÿè£…ï¼‰
                    await this.saveConfigMock(config);
                    
                    MCPUIComponents.showModal(
                        'âœ… è¨­å®šä¿å­˜å®Œäº†',
                        `<p>WordPressè¨­å®šãŒæ­£å¸¸ã«ä¿å­˜ãƒ»é©ç”¨ã•ã‚Œã¾ã—ãŸã€‚</p>
                         <p><strong>é©ç”¨ã•ã‚ŒãŸè¨­å®š:</strong></p>
                         <ul style="margin: 10px 0 0 20px;">
                           <li>WordPress URL: ${this.wpUrl.value}</li>
                           <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼å: ${this.wpUsername.value}</li>
                           <li>ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: ${this.wpTimeout.value}ç§’</li>
                           <li>çµ±åˆçŠ¶æ…‹: ${this.wpEnabled.checked ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹'}</li>
                         </ul>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                    );

                    this.addOperationLog('è¨­å®šä¿å­˜', 'WordPressè¨­å®šã‚’æ­£å¸¸ã«ä¿å­˜ãƒ»é©ç”¨ã—ã¾ã—ãŸ');
                    
                } catch (error) {
                    this.addOperationLog('ã‚¨ãƒ©ãƒ¼', `è¨­å®šä¿å­˜å¤±æ•—: ${error.message}`);
                    MCPUIComponents.showModal(
                        'âŒ è¨­å®šä¿å­˜å¤±æ•—',
                        `<p>è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p><p>${error.message}</p>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'danger' }]
                    );
                }
            }

            async testWordPressConnection() {
                if (!this.wpUrl.value || !this.wpUsername.value || !this.wpPassword.value) {
                    MCPUIComponents.showModal(
                        'âš ï¸ å…¥åŠ›ä¸å‚™',
                        '<p>WordPress URLã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>',
                        [{ text: 'é–‰ã˜ã‚‹', type: 'warning' }]
                    );
                    return;
                }

                try {
                    this.addOperationLog('æ¥ç¶šãƒ†ã‚¹ãƒˆ', 'WordPressæ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆä¸­...');
                    
                    // WordPressæ¥ç¶šãƒ†ã‚¹ãƒˆ
                    const result = await this.client.getWordPressResource('categories');
                    
                    MCPUIComponents.showModal(
                        'âœ… WordPressæ¥ç¶šãƒ†ã‚¹ãƒˆæˆåŠŸ',
                        `<p>WordPressã‚µãƒ¼ãƒãƒ¼ã«æ­£å¸¸ã«æ¥ç¶šã§ãã¾ã—ãŸã€‚</p>
                         <p><strong>æ¥ç¶šå…ˆ:</strong> ${this.wpUrl.value}</p>
                         <p><strong>å–å¾—ãƒ‡ãƒ¼ã‚¿:</strong> ${JSON.parse(result.contents[0].text).length}ä»¶ã®ã‚«ãƒ†ã‚´ãƒª</p>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                    );

                    this.addOperationLog('æ¥ç¶šãƒ†ã‚¹ãƒˆ', 'WordPressæ¥ç¶šãƒ†ã‚¹ãƒˆæˆåŠŸ');
                    
                } catch (error) {
                    this.addOperationLog('ã‚¨ãƒ©ãƒ¼', `WordPressæ¥ç¶šãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
                    MCPUIComponents.showModal(
                        'âŒ WordPressæ¥ç¶šãƒ†ã‚¹ãƒˆå¤±æ•—',
                        `<p>WordPressã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“ã§ã—ãŸã€‚</p>
                         <p><strong>ã‚¨ãƒ©ãƒ¼:</strong> ${error.message}</p>
                         <p><strong>ç¢ºèªé …ç›®:</strong></p>
                         <ul style="margin: 10px 0 0 20px;">
                           <li>WordPress URLãŒæ­£ã—ã„ã‹</li>
                           <li>REST APIãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹</li>
                           <li>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ã„ã‹</li>
                           <li>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã«å•é¡ŒãŒãªã„ã‹</li>
                         </ul>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'danger' }]
                    );
                }
            }

            generateConfig() {
                const config = {
                    server: {
                        bind_addr: `127.0.0.1:${this.httpPort.value}`,
                        stdio: this.transportType.value === 'stdio',
                        log_level: this.logLevel.value
                    },
                    transport: {
                        transport_type: this.transportType.value
                    },
                    handlers: {
                        wordpress: {
                            url: this.wpUrl.value,
                            username: this.wpUsername.value,
                            password: this.wpPassword.value,
                            timeout: parseInt(this.wpTimeout.value),
                            cache_ttl: parseInt(this.wpCacheTtl.value),
                            enabled: this.wpEnabled.checked
                        }
                    }
                };

                if (this.transportType.value === 'http') {
                    config.transport.http = {
                        addr: '127.0.0.1',
                        port: parseInt(this.httpPort.value),
                        enable_cors: true
                    };
                }

                return config;
            }

            previewConfig() {
                const config = this.generateConfig();
                const template = this.configTemplate.value;
                
                let configText;
                
                switch (template) {
                    case 'claude-desktop':
                        config.server.stdio = true;
                        config.server.log_level = 'error'; // Claude Desktopæ¨å¥¨
                        config.transport.transport_type = 'stdio';
                        break;
                    case 'web-ui':
                        config.server.stdio = false;
                        break;
                    case 'production':
                        // æœ¬ç•ªç”¨è¨­å®šè¿½åŠ 
                        config.server.log_retention = {
                            policy: 'external',
                            days: 30
                        };
                        config.server.log_module = {
                            separation: 'separated'
                        };
                        break;
                    case 'development':
                        config.server.log_level = 'debug';
                        break;
                }

                configText = `# MCP-RS è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« (${template})
# ç”Ÿæˆæ—¥æ™‚: ${new Date().toLocaleString('ja-JP')}

${this.objectToToml(config)}`;

                this.configPreview.textContent = configText;
                this.addOperationLog('ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼', `${template}è¨­å®šã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ç”Ÿæˆã—ã¾ã—ãŸ`);
            }

            objectToToml(obj, prefix = '') {
                let toml = '';
                
                for (const [key, value] of Object.entries(obj)) {
                    if (typeof value === 'object' && value !== null && !Array.isArray(value)) {
                        const section = prefix ? `${prefix}.${key}` : key;
                        toml += `\n[${section}]\n`;
                        toml += this.objectToToml(value, section);
                    } else {
                        if (typeof value === 'string') {
                            toml += `${key} = "${value}"\n`;
                        } else if (typeof value === 'boolean') {
                            toml += `${key} = ${value}\n`;
                        } else {
                            toml += `${key} = ${value}\n`;
                        }
                    }
                }
                
                return toml;
            }

            updateTransportSettings() {
                const httpSettings = document.getElementById('http-settings');
                httpSettings.style.display = this.transportType.value === 'http' ? 'block' : 'none';
            }

            async reloadConfig() {
                try {
                    this.addOperationLog('ãƒªãƒ­ãƒ¼ãƒ‰', 'è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å†èª­ã¿è¾¼ã¿ä¸­...');
                    // await this.configManager.reloadConfig();
                    
                    MCPUIComponents.showModal(
                        'âœ… è¨­å®šãƒªãƒ­ãƒ¼ãƒ‰å®Œäº†',
                        '<p>è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£å¸¸ã«å†èª­ã¿è¾¼ã¿ã•ã‚Œã¾ã—ãŸã€‚</p>',
                        [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                    );

                    this.addOperationLog('ãƒªãƒ­ãƒ¼ãƒ‰', 'è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å†èª­ã¿è¾¼ã¿å®Œäº†');
                    
                } catch (error) {
                    this.addOperationLog('ã‚¨ãƒ©ãƒ¼', `è¨­å®šãƒªãƒ­ãƒ¼ãƒ‰å¤±æ•—: ${error.message}`);
                }
            }

            async switchTransport() {
                const newType = this.transportType.value;
                
                try {
                    this.addOperationLog('Transportåˆ‡ã‚Šæ›¿ãˆ', `${newType}ã«åˆ‡ã‚Šæ›¿ãˆä¸­...`);
                    // await this.configManager.switchTransport(newType);
                    
                    MCPUIComponents.showModal(
                        'âœ… Transportåˆ‡ã‚Šæ›¿ãˆå®Œäº†',
                        `<p>Transport ãŒ ${newType} ã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã—ãŸã€‚</p>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                    );

                    this.addOperationLog('Transportåˆ‡ã‚Šæ›¿ãˆ', `${newType}ã¸ã®åˆ‡ã‚Šæ›¿ãˆå®Œäº†`);
                    
                } catch (error) {
                    this.addOperationLog('ã‚¨ãƒ©ãƒ¼', `Transportåˆ‡ã‚Šæ›¿ãˆå¤±æ•—: ${error.message}`);
                }
            }

            async applyLogLevel() {
                const newLevel = this.logLevel.value;
                
                try {
                    this.addOperationLog('ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«å¤‰æ›´', `${newLevel}ã«å¤‰æ›´ä¸­...`);
                    // å‹•çš„ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«å¤‰æ›´ã®å®Ÿè£…
                    
                    MCPUIComponents.showModal(
                        'âœ… ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«å¤‰æ›´å®Œäº†',
                        `<p>ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ãŒ ${newLevel.toUpperCase()} ã«å¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚</p>`,
                        [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                    );

                    this.addOperationLog('ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«å¤‰æ›´', `${newLevel}ã¸ã®å¤‰æ›´å®Œäº†`);
                    
                } catch (error) {
                    this.addOperationLog('ã‚¨ãƒ©ãƒ¼', `ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«å¤‰æ›´å¤±æ•—: ${error.message}`);
                }
            }

            async restartServer() {
                MCPUIComponents.showModal(
                    'âš ï¸ ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•ç¢ºèª',
                    '<p>MCPã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ã—ã¾ã™ã‹ï¼Ÿ</p><p><strong>æ³¨æ„:</strong> ä¸€æ™‚çš„ã«æ¥ç¶šãŒåˆ‡æ–­ã•ã‚Œã¾ã™ã€‚</p>',
                    [
                        { 
                            text: 'å†èµ·å‹•ã™ã‚‹', 
                            type: 'danger',
                            onclick: 'this.closest(\'.modal\').remove(); window.wordpressConfigManager.executeServerRestart();'
                        },
                        { text: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«', type: 'secondary' }
                    ]
                );
            }

            async executeServerRestart() {
                try {
                    this.addOperationLog('ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•', 'å†èµ·å‹•å‡¦ç†ã‚’å®Ÿè¡Œä¸­...');
                    // ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•ã®å®Ÿè£…
                    
                    MCPUIComponents.updateStatus(
                        this.statusElement, 
                        'warning', 
                        'ğŸ”„ ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•ä¸­...', 
                        true
                    );

                    // å†èµ·å‹•å¾Œã®å†æ¥ç¶š
                    setTimeout(() => this.testConnection(), 5000);
                    
                } catch (error) {
                    this.addOperationLog('ã‚¨ãƒ©ãƒ¼', `ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•å¤±æ•—: ${error.message}`);
                }
            }

            async copyConfig() {
                const success = await MCPUIComponents.copyToClipboard(this.configPreview.textContent);
                
                if (success) {
                    MCPUIComponents.showModal(
                        'âœ… ã‚³ãƒ”ãƒ¼å®Œäº†',
                        '<p>è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚</p>',
                        [{ text: 'é–‰ã˜ã‚‹', type: 'primary' }]
                    );
                    this.addOperationLog('ã‚³ãƒ”ãƒ¼', 'è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
                } else {
                    MCPUIComponents.showModal(
                        'âŒ ã‚³ãƒ”ãƒ¼å¤±æ•—',
                        '<p>ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã®ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>',
                        [{ text: 'é–‰ã˜ã‚‹', type: 'danger' }]
                    );
                }
            }

            downloadConfig() {
                const template = this.configTemplate.value;
                const filename = `mcp-config-${template}.toml`;
                
                MCPUIComponents.downloadFile(
                    this.configPreview.textContent,
                    filename,
                    'text/plain'
                );

                this.addOperationLog('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰', `è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« ${filename} ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ`);
            }

            // ãƒ¢ãƒƒã‚¯é–¢æ•°ç¾¤
            async getCurrentConfigMock() {
                // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ configManager.getCurrentConfig() ã‚’ä½¿ç”¨
                return {
                    server: {
                        log_level: 'info'
                    },
                    transport: {
                        transport_type: 'http',
                        http: { port: 8081 }
                    },
                    handlers: {
                        wordpress: {
                            url: 'https://example.wordpress.com',
                            username: 'admin',
                            password: '****',
                            timeout: 30,
                            cache_ttl: 300,
                            enabled: true
                        }
                    }
                };
            }

            async saveConfigMock(config) {
                // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ configManager.updateConfig(config) ã‚’ä½¿ç”¨
                console.log('Saving config:', config);
                await new Promise(resolve => setTimeout(resolve, 1000)); // é…å»¶ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
            }

            addOperationLog(type, message) {
                this.operationLog.unshift({
                    type,
                    message,
                    timestamp: new Date().toLocaleString('ja-JP')
                });

                if (this.operationLog.length > 15) {
                    this.operationLog = this.operationLog.slice(0, 15);
                }

                this.updateLogDisplay();
            }

            updateLogDisplay() {
                const container = document.getElementById('operation-log');
                
                if (this.operationLog.length === 0) {
                    container.innerHTML = `
                        <div class="text-center" style="color: #6c757d; padding: 20px;">
                            <p>è¨­å®šå¤‰æ›´ã®æ“ä½œãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.operationLog.map(log => `
                    <div style="padding: 10px; border-left: 3px solid #4a90e2; margin-bottom: 10px; background: #f8f9fa;">
                        <strong>${log.type}</strong> - ${log.message}
                        <br><small style="color: #6c757d;">${log.timestamp}</small>
                    </div>
                `).join('');
            }
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            window.wordpressConfigManager = new WordPressConfigManager();
        });
    </script>
</body>
</html>