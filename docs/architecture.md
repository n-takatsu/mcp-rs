# MCP-RS アーキテクチャ設計ドキュメント

---
**📅 作成日時**: 2025年11月2日  
**🔖 アーキテクチャバージョン**: v0.1.0-alpha  
**🚀 実装バージョン**: v0.1.0 (開発中)  
**✍️ 最終更新**: 2025年11月3日 - 実装状況更新・ドキュメント整備完了  
**📋 ステータス**: 基盤実装段階 (WordPress Handler + 設定システム完了)  
---

## ドキュメント履歴

| 日付 | バージョン | 変更内容 | 担当者 |
|------|------------|----------|--------|
| 2025-11-02 | v0.1.0-alpha | 初期アーキテクチャ設計策定、WordPress Handler実装完了 | 開発チーム |
| 2025-11-03 | v0.1.0-alpha | 実装状況更新、GitHub Pages用ドキュメント整備、本番設定対応 | 開発チーム |

## 現在の実装状況と最終設計予想

### レイヤー構造

```
┌─────────────────────────────────────────────────────┐
│ Application Layer                                   │
│ ├── main.rs (エントリーポイント)                     │
│ └── CLI/サーバー起動                                 │
├─────────────────────────────────────────────────────┤
│ API Layer                                           │
│ ├── mcp/ (Model Context Protocol実装)               │
│ ├── protocol.rs (プロトコル定義)                    │
│ └── JSON-RPC インターフェース                        │
├─────────────────────────────────────────────────────┤
│ Service Layer                                       │
│ ├── handlers/ (具体的機能実装)                      │
│ │   └── wordpress.rs (✅実装済み)                   │
│ └── plugins/ (動的プラグインシステム) [🔄予定]      │
├─────────────────────────────────────────────────────┤
│ Core Layer [🔄現在空 - 将来の中核機能]              │
│ ├── runtime.rs (非同期ランタイム管理)               │
│ ├── registry.rs (ハンドラー/プラグイン登録)         │
│ ├── context.rs (実行コンテキスト)                   │
│ ├── lifecycle.rs (アプリケーションライフサイクル)   │
│ ├── events.rs (イベントシステム)                    │
│ └── metrics.rs (監視・メトリクス)                   │
├─────────────────────────────────────────────────────┤
│ Infrastructure Layer                                │
│ ├── transport/ (通信抽象化) [🔄予定]                │
│ │   ├── stdio.rs (標準入出力)                       │
│ │   ├── http.rs (HTTPサーバー)                      │
│ │   └── websocket.rs (WebSocket)                    │
│ ├── config/ (設定管理) ✅実装済み                   │
│ └── error.rs (エラーハンドリング) ✅実装済み        │
└─────────────────────────────────────────────────────┘
```

## 設計原則

### 1. プラグイン指向アーキテクチャ
- **ハンドラーシステム**: `McpHandler`トレイトによる統一インターフェース
- **動的プラグイン**: ランタイムでの機能追加・削除
- **設定駆動**: TOMLファイルでの機能有効化制御

### 2. トランスポート抽象化
- **マルチプロトコル対応**: stdio, HTTP, WebSocket等
- **統一インターフェース**: `Transport`トレイトで抽象化
- **非同期I/O**: tokioベースの高性能通信

### 3. 設定駆動設計
- **階層化設定**: ファイル → 環境変数 → CLIの優先順位
- **動的再読み込み**: 設定変更の即座反映
- **型安全**: serdeによる強型設定管理

## 実装進捗

### ✅ 完成済み (2025-11-03現在)
- **WordPress APIハンドラー**: タイムアウト・リトライ・エラーハンドリング完備
- **設定管理システム**: TOML + 環境変数の階層化設定
- **MCPプロトコル基本実装**: JSON-RPC + ハンドラートレイト
- **エラーハンドリング**: thiserror ベースの型安全エラー管理
- **詳細ログシステム**: tracing による構造化ログ
- **HTTP通信基盤**: reqwest + タイムアウト + 指数バックオフリトライ
- **本番環境対応**: 設定ファイル保護(.gitignore)、本番設定テンプレート
- **ドキュメント整備**: GitHub Pages対応、API仕様書、実装ガイド完備

### 🔄 実装予定
- `core/`モジュール（アプリケーション中核）
- `transport/`モジュール（通信抽象化）
- `plugins/`モジュール（動的プラグイン）
- パフォーマンス監視
- 統合テストスイート

### 🎯 想定される用途
- AI エージェント統合基盤
- WordPress などの CMS 操作自動化
- GitHub などの開発ツール連携
- カスタムツール・プラグイン開発プラットフォーム

## アーキテクチャの利点

1. **拡張性**: プラグインシステムによる機能追加
2. **保守性**: レイヤー分離による責任明確化
3. **再利用性**: 共通インターフェースによるコンポーネント化
4. **テスタビリティ**: 依存性注入による単体テスト容易性
5. **パフォーマンス**: 非同期処理とリソース効率化

---

## 📋 設計決定記録 (Architecture Decision Records)

### ADR-001: レイヤードアーキテクチャの採用
- **決定日**: 2025-11-02
- **背景**: 拡張性と保守性を確保するため
- **決定**: Core, Service, API, Infrastructure の4層構造
- **影響**: モジュール間の依存関係明確化、テスト容易性向上

### ADR-002: プラグイン指向設計
- **決定日**: 2025-11-02  
- **背景**: 多様なAIエージェント統合要件への対応
- **決定**: `McpHandler`トレイトベースのプラグインシステム
- **影響**: 動的機能追加、設定駆動での有効化制御

### ADR-003: 非同期ファーストアプローチ
- **決定日**: 2025-11-02
- **背景**: I/O集約的なAPI操作の効率化
- **決定**: tokio + async/await ベースの実装
- **影響**: 高並行性、リソース効率化、タイムアウト制御

---

## 🔄 次期バージョン予定

### v0.2.0 (予定: 2025年12月)
- [ ] `core/`モジュール実装
- [ ] `transport/`モジュール実装  
- [ ] stdio トランスポート対応
- [ ] プラグイン動的ロード機能

### v0.3.0 (予定: 2026年1月)
- [ ] WebSocket トランスポート対応
- [ ] メトリクス・監視機能
- [ ] パフォーマンス最適化
- [ ] 統合テストスイート完備

### v1.0.0 (予定: 2026年3月)
- [ ] 本格運用対応
- [ ] ドキュメント完備
- [ ] セキュリティ監査
- [ ] エコシステム構築

---

## ⚠️ 重要な注意事項

このドキュメントは設計指針を示すものであり、実装過程での変更が予想されます。  
**メジャーバージョンリリース時には、このドキュメントと実際の実装を比較検証し、アーキテクチャの整合性を確認することを強く推奨します。**

最終判断基準:
- 設計原則との整合性
- パフォーマンス要件達成度  
- 拡張性・保守性の実現度
- テスタビリティの確保度