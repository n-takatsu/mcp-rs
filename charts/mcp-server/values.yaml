# Default values for mcp-server production deployment
# This is a YAML-formatted file.

# Global settings
global:
  environment: production
  
# Image configuration
image:
  repository: ghcr.io/n-takatsu/mcp-rs
  pullPolicy: IfNotPresent
  tag: "0.15.0"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# Replica configuration for High Availability
replicaCount: 3

# Service configuration
service:
  type: ClusterIP
  port: 3000
  targetPort: 3000
  annotations: {}
  # For AWS NLB example:
  # service.beta.kubernetes.io/aws-load-balancer-type: "nlb"

# Ingress configuration
ingress:
  enabled: false
  className: "nginx"
  annotations: {}
    # cert-manager.io/cluster-issuer: "letsencrypt-prod"
    # nginx.ingress.kubernetes.io/ssl-redirect: "true"
  hosts:
    - host: mcp-server.example.com
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: mcp-server-tls
  #    hosts:
  #      - mcp-server.example.com

# Resource limits and requests
resources:
  limits:
    cpu: 2000m
    memory: 4Gi
  requests:
    cpu: 500m
    memory: 1Gi

# Horizontal Pod Autoscaler
autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
      - type: Percent
        value: 50
        periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 0
      policies:
      - type: Percent
        value: 100
        periodSeconds: 15
      - type: Pods
        value: 2
        periodSeconds: 15
      selectPolicy: Max

# Pod Disruption Budget for HA
podDisruptionBudget:
  enabled: true
  minAvailable: 2
  # maxUnavailable: 1

# Security Context
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000
  seccompProfile:
    type: RuntimeDefault

containerSecurityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000
  capabilities:
    drop:
      - ALL

# Service Account
serviceAccount:
  create: true
  annotations: {}
  name: ""
  automount: true

# Pod annotations
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "9090"
  prometheus.io/path: "/metrics"

# Pod labels
podLabels:
  app: mcp-server
  version: v0.15.0

# Node selector
nodeSelector: {}
  # kubernetes.io/os: linux
  # node.kubernetes.io/instance-type: t3.medium

# Tolerations
tolerations: []
  # - key: "dedicated"
  #   operator: "Equal"
  #   value: "mcp-server"
  #   effect: "NoSchedule"

# Affinity for pod distribution
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app
                operator: In
                values:
                  - mcp-server
          topologyKey: kubernetes.io/hostname

# Liveness probe
livenessProbe:
  httpGet:
    path: /health
    port: 3000
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  successThreshold: 1
  failureThreshold: 3

# Readiness probe
readinessProbe:
  httpGet:
    path: /ready
    port: 3000
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  successThreshold: 1
  failureThreshold: 3

# Startup probe (for slow starting containers)
startupProbe:
  httpGet:
    path: /health
    port: 3000
  initialDelaySeconds: 0
  periodSeconds: 10
  timeoutSeconds: 3
  successThreshold: 1
  failureThreshold: 30

# MCP Server configuration
config:
  # Transport mode: stdio, http, websocket
  transport: http
  port: 3000
  
  # Log level: trace, debug, info, warn, error
  logLevel: info
  logFormat: json
  
  # Security policy
  securityPolicy:
    enabled: true
    policyFile: /etc/mcp/security-policy.toml
  
  # Plugin configuration
  plugins:
    enabled: true
    directory: /etc/mcp/plugins
    isolationLevel: container
  
  # Rate limiting
  rateLimit:
    enabled: true
    requestsPerSecond: 1000
    burstSize: 2000
  
  # Database configuration (if needed)
  database:
    enabled: false
    type: postgresql
    host: postgresql.default.svc.cluster.local
    port: 5432
    name: mcpdb
    # Credentials should be stored in secrets
  
  # Redis cache (if needed)
  redis:
    enabled: false
    host: redis.default.svc.cluster.local
    port: 6379

# ConfigMap for configuration files
configMap:
  enabled: true
  data: {}
  # security-policy.toml: |
  #   [security]
  #   enabled = true

# Secrets management
secrets:
  enabled: true
  # External secrets operator integration
  externalSecrets:
    enabled: false
    backendType: secretsManager
    # AWS Secrets Manager, Azure Key Vault, GCP Secret Manager
  
  # Direct secret values (not recommended for production)
  data: {}
  # API_KEY: ""
  # DB_PASSWORD: ""

# Persistent volumes for logs and data
persistence:
  enabled: true
  storageClass: ""
  accessMode: ReadWriteOnce
  size: 10Gi
  mountPath: /var/lib/mcp
  annotations: {}

# Monitoring integration
monitoring:
  enabled: true
  serviceMonitor:
    enabled: false
    interval: 30s
    scrapeTimeout: 10s
  
  # Prometheus rules
  prometheusRules:
    enabled: false
    rules: []

# Network policies
networkPolicy:
  enabled: false
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
      - namespaceSelector:
          matchLabels:
            name: default
      ports:
      - protocol: TCP
        port: 3000
  egress:
    - to:
      - namespaceSelector: {}
      ports:
      - protocol: TCP
        port: 443
      - protocol: TCP
        port: 5432

# Backup configuration
backup:
  enabled: false
  schedule: "0 2 * * *"
  retention: 7
  storageClass: ""
  volumeSize: 20Gi

# Deployment strategy
strategy:
  type: RollingUpdate
  rollingUpdate:
    maxSurge: 1
    maxUnavailable: 0

# Pod priority
priorityClassName: ""

# Additional volumes
extraVolumes: []
# - name: custom-config
#   configMap:
#     name: custom-config

# Additional volume mounts
extraVolumeMounts: []
# - name: custom-config
#   mountPath: /etc/custom

# Environment variables
env: []
# - name: CUSTOM_VAR
#   value: "custom-value"

# Environment variables from secrets/configmaps
envFrom: []
# - secretRef:
#     name: mcp-server-secrets
# - configMapRef:
#     name: mcp-server-config

# Init containers
initContainers: []
# - name: init-config
#   image: busybox:1.35
#   command: ['sh', '-c', 'echo "Initializing..."']

# Sidecar containers
sidecars: []
# - name: log-forwarder
#   image: fluent/fluent-bit:2.0

# Pod termination grace period
terminationGracePeriodSeconds: 30

# DNS configuration
dnsPolicy: ClusterFirst
dnsConfig: {}
# nameservers:
#   - 1.1.1.1
# searches:
#   - example.com

# Host aliases
hostAliases: []
# - ip: "127.0.0.1"
#   hostnames:
#   - "foo.local"

# Tests
tests:
  enabled: true
  image:
    repository: busybox
    tag: 1.35
