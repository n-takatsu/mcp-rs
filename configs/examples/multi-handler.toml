# MCP-RS Multi-Handler Configuration
# 
# 複数のハンドラーを設定可能な拡張設定ファイル例

[server]
bind_addr = "127.0.0.1:8080"
stdio = false
log_level = "info"
default_handler = "wordpress_main"

# =============================================================================
# WordPress ハンドラー設定
# =============================================================================

[handlers.wordpress_main]
type = "wordpress"
name = "Main WordPress Site"
enabled = true

[handlers.wordpress_main.connection]
endpoint = "${WORDPRESS_URL}"
auth = { type = "basic", username = "${WORDPRESS_USERNAME}", password = "${WORDPRESS_PASSWORD}" }
timeout_seconds = 30
retry_attempts = 3

[handlers.wordpress_main.security]
use_tls = true
verify_cert = true
rate_limit = { requests_per_minute = 600, burst_size = 20 }
allowed_ips = ["127.0.0.1", "192.168.1.0/24"]

[handlers.wordpress_staging]
type = "wordpress"
name = "Staging WordPress Site"
enabled = false

[handlers.wordpress_staging.connection]
endpoint = "${WORDPRESS_STAGING_URL}"
auth = { type = "basic", username = "${WORDPRESS_STAGING_USERNAME}", password = "${WORDPRESS_STAGING_PASSWORD}" }
timeout_seconds = 30
retry_attempts = 3

# =============================================================================
# データベースハンドラー設定
# =============================================================================

[handlers.postgres_main]
type = "database"
database_type = "postgresql"
name = "Main PostgreSQL Database"
enabled = false

[handlers.postgres_main.connection]
endpoint = "postgresql://${DB_HOST}:5432/${DB_NAME}"
auth = { type = "basic", username = "${DB_USERNAME}", password = "${DB_PASSWORD}" }
timeout_seconds = 60
retry_attempts = 3

[handlers.postgres_main.security]
use_tls = true
verify_cert = true
rate_limit = { requests_per_minute = 300, burst_size = 10 }

[handlers.postgres_main.custom]
max_connections = 10
connection_timeout = 30
idle_timeout = 300

[handlers.mysql_analytics]
type = "database"
database_type = "mysql"
name = "Analytics MySQL Database"
enabled = false

[handlers.mysql_analytics.connection]
endpoint = "mysql://${MYSQL_HOST}:3306/${MYSQL_DB}"
auth = { type = "basic", username = "${MYSQL_USERNAME}", password = "${MYSQL_PASSWORD}" }
timeout_seconds = 60
retry_attempts = 3

# =============================================================================
# ファイルシステムハンドラー設定
# =============================================================================

[handlers.local_filesystem]
type = "filesystem"
name = "Local File System"
enabled = false

[handlers.local_filesystem.connection]
endpoint = "/var/www/uploads"
auth = { type = "none" }
timeout_seconds = 10
retry_attempts = 1

[handlers.local_filesystem.security]
use_tls = false
verify_cert = false
allowed_ips = ["127.0.0.1"]

[handlers.local_filesystem.custom]
max_file_size = 104857600  # 100MB
allowed_extensions = [".jpg", ".png", ".pdf", ".txt"]
read_only = false

# =============================================================================
# クラウドサービスハンドラー設定
# =============================================================================

[handlers.aws_s3]
type = "cloud_service"
cloud_provider = "aws"
name = "AWS S3 Storage"
enabled = false

[handlers.aws_s3.connection]
endpoint = "https://s3.amazonaws.com"
auth = { type = "custom", access_key = "${AWS_ACCESS_KEY}", secret_key = "${AWS_SECRET_KEY}", region = "${AWS_REGION}" }
timeout_seconds = 60
retry_attempts = 3

[handlers.aws_s3.custom]
bucket_name = "${S3_BUCKET_NAME}"
default_acl = "private"

[handlers.gcp_storage]
type = "cloud_service"
cloud_provider = "gcp"
name = "Google Cloud Storage"
enabled = false

[handlers.gcp_storage.connection]
endpoint = "https://storage.googleapis.com"
auth = { type = "oauth2", token = "${GCP_ACCESS_TOKEN}" }
timeout_seconds = 60
retry_attempts = 3

# =============================================================================
# Web API ハンドラー設定
# =============================================================================

[handlers.external_api]
type = "web_api"
name = "External REST API"
enabled = false

[handlers.external_api.connection]
endpoint = "${EXTERNAL_API_URL}"
auth = { type = "api_key", key = "${EXTERNAL_API_KEY}", header = "X-API-Key" }
timeout_seconds = 30
retry_attempts = 3

[handlers.external_api.security]
use_tls = true
verify_cert = true
rate_limit = { requests_per_minute = 1000, burst_size = 50 }

[handlers.external_api.custom]
api_version = "v1"
response_format = "json"

# =============================================================================
# メッセージキューハンドラー設定
# =============================================================================

[handlers.redis_queue]
type = "message_queue"
name = "Redis Message Queue"
enabled = false

[handlers.redis_queue.connection]
endpoint = "redis://${REDIS_HOST}:6379"
auth = { type = "basic", username = "", password = "${REDIS_PASSWORD}" }
timeout_seconds = 10
retry_attempts = 3

[handlers.redis_queue.custom]
default_queue = "mcp_tasks"
max_message_size = 1048576  # 1MB

# =============================================================================
# カスタムハンドラー設定
# =============================================================================

[handlers.custom_handler]
type = "custom"
custom_type = "elasticsearch"
name = "Elasticsearch Cluster"
enabled = false

[handlers.custom_handler.connection]
endpoint = "${ELASTICSEARCH_URL}"
auth = { type = "basic", username = "${ES_USERNAME}", password = "${ES_PASSWORD}" }
timeout_seconds = 60
retry_attempts = 3

[handlers.custom_handler.custom]
index_prefix = "mcp"
default_type = "_doc"

# =============================================================================
# グローバルセキュリティ設定
# =============================================================================

[security]
# 脅威インテリジェンス設定
threat_intelligence_enabled = true
virustotal_api_key = "${VIRUSTOTAL_API_KEY}"

# 監査ログ設定
audit_log_enabled = true
audit_log_path = "/var/log/mcp-rs/audit.log"

# 暗号化設定
encrypt_sensitive_data = true
encryption_key = "${ENCRYPTION_KEY}"

# =============================================================================
# パフォーマンス設定
# =============================================================================

[performance]
# 接続プール設定
max_concurrent_handlers = 10
handler_pool_size = 5

# キャッシュ設定
cache_enabled = true
cache_ttl_seconds = 300
cache_max_entries = 1000

# メトリクス設定
metrics_enabled = true
metrics_endpoint = "/metrics"