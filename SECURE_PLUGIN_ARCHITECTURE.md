# ã‚»ã‚­ãƒ¥ã‚¢ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆææ¡ˆ

## ğŸš¨ ç¾åœ¨ã®è¨­è¨ˆã®è„†å¼±æ€§åˆ†æ

### 1. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¢ƒç•Œã®å•é¡Œ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¾åœ¨ã®è¨­è¨ˆï¼ˆå±é™ºï¼‰                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€ MCP-RS Core â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ â”Œâ”€ Plugin A â”€â” â”Œâ”€ Plugin B â”€â” â”‚   â”‚
â”‚ â”‚ â”‚ æ‚ªæ„ã‚³ãƒ¼ãƒ‰  â”‚ â”‚ æ­£å¸¸ã‚³ãƒ¼ãƒ‰  â”‚ â”‚   â”‚
â”‚ â”‚ â”‚ â†“ç›´æ¥å®Ÿè¡Œ  â”‚ â”‚           â”‚ â”‚   â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚ â”‚ â† ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¢ƒç•Œãªã— â†’      â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. å…·ä½“çš„ãªãƒªã‚¹ã‚¯
- **ãƒ¡ãƒ¢ãƒªæ±šæŸ“**: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒæœ¬ä½“ã®ãƒ¡ãƒ¢ãƒªç©ºé–“ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- **æ¨©é™æ˜‡æ ¼**: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒæœ¬ä½“ã¨åŒç­‰ã®æ¨©é™ã§å®Ÿè¡Œ
- **ãƒ‡ãƒ¼ã‚¿æ¼æ´©**: ä»–ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚„æœ¬ä½“ã®æ©Ÿå¯†æƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- **ã‚·ã‚¹ãƒ†ãƒ ç ´å£Š**: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚’åœæ­¢å¯èƒ½

## ğŸ›¡ï¸ ææ¡ˆï¼šç‰©ç†åˆ†é›¢å‹ã‚»ã‚­ãƒ¥ã‚¢ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 1. ãƒãƒ«ãƒã‚µãƒ¼ãƒãƒ¼å¢ƒç•Œåˆ†é›¢è¨­è¨ˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç‰©ç†çš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¢ƒç•Œ                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚ â”Œâ”€ MCP Core Server (Protected) â”€â”   Network Boundary   â”‚
â”‚ â”‚ - èªè¨¼ãƒ»èªå¯                   â”‚        â”‚              â”‚
â”‚ â”‚ - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¤œè¨¼             â”‚        â”‚              â”‚
â”‚ â”‚ - ãƒ¬ãƒ¼ãƒˆåˆ¶é™                   â”‚        â”‚              â”‚
â”‚ â”‚ - ç›£æŸ»ãƒ­ã‚°                     â”‚        â–¼              â”‚
â”‚ â”‚ - ãƒªã‚¯ã‚¨ã‚¹ãƒˆé…ä¿¡               â”‚ â”Œâ”€ Plugin Servers â”€â”  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”Œâ”€ Plugin A â”€â”  â”‚  â”‚
â”‚           â–²                       â”‚ â”‚ â”‚ éš”é›¢å®Ÿè¡Œ   â”‚  â”‚  â”‚
â”‚           â”‚ gRPC/HTTP API         â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚           â”‚                       â”‚ â”‚ â”Œâ”€ Plugin B â”€â”  â”‚  â”‚
â”‚ â”Œâ”€ API Gateway â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ éš”é›¢å®Ÿè¡Œ   â”‚  â”‚  â”‚
â”‚ â”‚ - TLSçµ‚ç«¯                     â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚ â”‚ - èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼             â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â”‚ - ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚           â–²                                              â”‚
â”‚           â”‚ HTTPS                                        â”‚
â”‚           â”‚                                              â”‚
â”‚ â”Œâ”€ Client Applications â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚ â”‚ - Claude, ChatGPTç­‰          â”‚                        â”‚
â”‚ â”‚ - ã‚«ã‚¹ã‚¿ãƒ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ         â”‚                        â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­è¨ˆ

#### Layer 1: Core Serverï¼ˆå®Œå…¨ä¿è­·ï¼‰
```rust
// src/core/secure_server.rs
use std::collections::HashMap;
use tokio::sync::RwLock;

/// å®Œå…¨ã«ä¿è­·ã•ã‚ŒãŸã‚³ã‚¢ã‚µãƒ¼ãƒãƒ¼
pub struct SecureCoreServer {
    /// ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚µãƒ¼ãƒãƒ¼ã®æ¥ç¶šæƒ…å ±ï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ï¼‰
    plugin_endpoints: RwLock<HashMap<String, PluginEndpoint>>,
    /// ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã‚¨ãƒ³ã‚¸ãƒ³
    security_engine: SecurityPolicyEngine,
    /// ç›£æŸ»ãƒ­ã‚°ï¼ˆæ”¹ã–ã‚“é˜²æ­¢ï¼‰
    audit_logger: TamperProofAuditLogger,
}

#[derive(Clone)]
pub struct PluginEndpoint {
    /// ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚µãƒ¼ãƒãƒ¼ã®URL
    pub url: String,
    /// èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆæš—å·åŒ–ï¼‰
    pub auth_token: EncryptedToken,
    /// è¨±å¯ã•ã‚ŒãŸæ“ä½œãƒªã‚¹ãƒˆ
    pub allowed_operations: Vec<String>,
    /// ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¨­å®š
    pub rate_limits: RateLimitConfig,
    /// ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹
    pub health_status: HealthStatus,
}

impl SecureCoreServer {
    /// ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¸ã®å®‰å…¨ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆè»¢é€
    pub async fn forward_request_to_plugin(
        &self,
        plugin_name: &str,
        request: SecureRequest,
    ) -> Result<SecureResponse, SecurityError> {
        // 1. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¤œè¨¼
        self.security_engine.validate_request(&request).await?;
        
        // 2. ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå–å¾—
        let endpoint = self.get_plugin_endpoint(plugin_name).await?;
        
        // 3. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒã‚§ãƒƒã‚¯
        self.security_engine.check_rate_limit(&endpoint, &request).await?;
        
        // 4. ãƒªã‚¯ã‚¨ã‚¹ãƒˆæš—å·åŒ–
        let encrypted_request = self.encrypt_request(request, &endpoint).await?;
        
        // 5. ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚µãƒ¼ãƒãƒ¼ã¸HTTPSè»¢é€
        let response = self.send_to_plugin(&endpoint, encrypted_request).await?;
        
        // 6. ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ¤œè¨¼ãƒ»å¾©å·åŒ–
        let validated_response = self.validate_and_decrypt_response(response).await?;
        
        // 7. ç›£æŸ»ãƒ­ã‚°è¨˜éŒ²
        self.audit_logger.log_plugin_interaction(plugin_name, &validated_response).await?;
        
        Ok(validated_response)
    }
}
```

#### Layer 2: Plugin Serverï¼ˆéš”é›¢å®Ÿè¡Œï¼‰
```rust
// src/plugins/isolated_server.rs

/// éš”é›¢ã•ã‚ŒãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚µãƒ¼ãƒãƒ¼
pub struct IsolatedPluginServer {
    /// ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å®Ÿè£…
    plugin: Box<dyn IsolatedPlugin>,
    /// ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹
    sandbox: SecuritySandbox,
    /// ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™
    resource_limits: ResourceLimits,
}

pub trait IsolatedPlugin: Send + Sync {
    /// éš”é›¢ç’°å¢ƒã§ã®åˆæœŸåŒ–
    async fn initialize_isolated(&self, config: SandboxConfig) -> Result<(), PluginError>;
    
    /// ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹å†…ã§ã®ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œ
    async fn execute_tool_sandboxed(
        &self,
        tool_name: &str,
        parameters: SanitizedParameters,
    ) -> Result<SanitizedResponse, PluginError>;
}

#[derive(Debug)]
pub struct SecuritySandbox {
    /// ãƒ¡ãƒ¢ãƒªåˆ¶é™ï¼ˆMBï¼‰
    pub max_memory_mb: u64,
    /// CPUåˆ¶é™ï¼ˆ%ï¼‰
    pub max_cpu_percent: u8,
    /// ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™
    pub network_restrictions: NetworkPolicy,
    /// ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™
    pub filesystem_restrictions: FilesystemPolicy,
    /// å®Ÿè¡Œæ™‚é–“åˆ¶é™ï¼ˆç§’ï¼‰
    pub execution_timeout_seconds: u64,
}

impl IsolatedPluginServer {
    /// ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹å†…ã§ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å®Ÿè¡Œ
    pub async fn execute_in_sandbox(
        &self,
        request: SanitizedRequest,
    ) -> Result<SanitizedResponse, PluginError> {
        // 1. ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™è¨­å®š
        self.sandbox.apply_resource_limits().await?;
        
        // 2. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ¶é™é©ç”¨
        self.sandbox.restrict_network_access().await?;
        
        // 3. ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ åˆ¶é™é©ç”¨
        self.sandbox.restrict_filesystem_access().await?;
        
        // 4. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
        let execution_future = self.plugin.execute_tool_sandboxed(
            &request.tool_name,
            request.parameters,
        );
        
        // 5. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ãå®Ÿè¡Œ
        match tokio::time::timeout(
            Duration::from_secs(self.resource_limits.execution_timeout_seconds),
            execution_future,
        ).await {
            Ok(result) => result,
            Err(_) => Err(PluginError::ExecutionTimeout),
        }
    }
}
```

### 3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«

#### mTLS + JWTèªè¨¼
```rust
// src/security/plugin_auth.rs

/// ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–“é€šä¿¡ã®èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 
pub struct PluginAuthSystem {
    /// ã‚³ã‚¢ã‚µãƒ¼ãƒãƒ¼ã®è¨¼æ˜æ›¸ï¼ˆCAï¼‰
    core_ca_cert: X509Certificate,
    /// ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨¼æ˜æ›¸ã®æ¤œè¨¼
    plugin_cert_validator: CertificateValidator,
    /// JWT ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†
    jwt_manager: JwtTokenManager,
}

impl PluginAuthSystem {
    /// ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚µãƒ¼ãƒãƒ¼ã¨ã®å®‰å…¨ãªæ¥ç¶šç¢ºç«‹
    pub async fn establish_secure_connection(
        &self,
        plugin_endpoint: &PluginEndpoint,
    ) -> Result<SecureConnection, AuthError> {
        // 1. mTLSæ¥ç¶šç¢ºç«‹
        let tls_connection = self.create_mtls_connection(plugin_endpoint).await?;
        
        // 2. ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨¼æ˜æ›¸æ¤œè¨¼
        self.plugin_cert_validator.verify_plugin_certificate(
            &tls_connection.peer_certificate()
        ).await?;
        
        // 3. JWT ãƒˆãƒ¼ã‚¯ãƒ³äº¤æ›
        let jwt_token = self.jwt_manager.create_plugin_token(
            &plugin_endpoint.plugin_id,
            &plugin_endpoint.allowed_operations,
        ).await?;
        
        // 4. ã‚»ã‚­ãƒ¥ã‚¢ãƒãƒ£ãƒãƒ«ç¢ºç«‹
        Ok(SecureConnection {
            tls_connection,
            jwt_token,
            plugin_id: plugin_endpoint.plugin_id.clone(),
        })
    }
}
```

### 4. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆåˆ†é›¢å‹ï¼‰

#### Core Serverè¨­å®š
```toml
# mcp-core-config.toml
[core_server]
bind_addr = "127.0.0.1:8080"
tls_cert_path = "/etc/mcp/certs/core-server.crt"
tls_key_path = "/etc/mcp/certs/core-server.key"
ca_cert_path = "/etc/mcp/certs/ca.crt"

[security]
max_request_size_mb = 10
request_timeout_seconds = 30
rate_limit_per_minute = 100

[audit]
log_level = "INFO"
log_file = "/var/log/mcp/core-audit.log"
tamper_protection = true

[plugins]
discovery_timeout_seconds = 10
health_check_interval_seconds = 30

# ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚µãƒ¼ãƒãƒ¼ã®æ¥ç¶šæƒ…å ±
[[plugins.servers]]
name = "wordpress-handler"
url = "https://plugin-wordpress:8443"
cert_path = "/etc/mcp/certs/wordpress-plugin.crt"
allowed_operations = ["list_posts", "create_post", "update_post"]
max_requests_per_minute = 50

[[plugins.servers]]
name = "github-handler"
url = "https://plugin-github:8444"
cert_path = "/etc/mcp/certs/github-plugin.crt"
allowed_operations = ["list_repos", "create_issue"]
max_requests_per_minute = 30
```

#### Plugin Serverè¨­å®š
```toml
# wordpress-plugin-config.toml
[plugin_server]
name = "wordpress-handler"
bind_addr = "0.0.0.0:8443"
tls_cert_path = "/etc/plugin/certs/wordpress.crt"
tls_key_path = "/etc/plugin/certs/wordpress.key"
core_server_url = "https://mcp-core:8080"

[sandbox]
max_memory_mb = 512
max_cpu_percent = 50
execution_timeout_seconds = 10

[network_policy]
allowed_domains = ["wordpress.example.com"]
blocked_domains = ["*"]
allow_localhost = false

[filesystem_policy]
read_only_paths = ["/app/config"]
writable_paths = ["/tmp/plugin-cache"]
blocked_paths = ["/", "/etc", "/var"]

[wordpress]
url = "https://wordpress.example.com"
# èªè¨¼æƒ…å ±ã¯ç’°å¢ƒå¤‰æ•°ã¾ãŸã¯ç§˜å¯†ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰å–å¾—
```

### 5. Dockerã‚³ãƒ³ãƒ†ãƒŠåˆ†é›¢

#### Core Serverï¼ˆæœ€å°æ¨©é™ï¼‰
```dockerfile
# Dockerfile.core
FROM scratch
COPY mcp-core /usr/local/bin/
COPY ca-certificates.crt /etc/ssl/certs/

# èª­ã¿å–ã‚Šå°‚ç”¨ãƒ«ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ 
VOLUME ["/var/log/mcp", "/etc/mcp/certs"]

USER 65534:65534  # nobody user
EXPOSE 8080

ENTRYPOINT ["/usr/local/bin/mcp-core"]
```

#### Plugin Serverï¼ˆã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ï¼‰
```dockerfile
# Dockerfile.plugin
FROM alpine:3.18
RUN adduser -D -s /bin/sh plugin

# æœ€å°é™ã®ãƒ„ãƒ¼ãƒ«ã®ã¿
RUN apk add --no-cache ca-certificates

COPY wordpress-plugin /usr/local/bin/
COPY plugin-config.toml /etc/plugin/

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–
RUN chmod 500 /usr/local/bin/wordpress-plugin
RUN chown plugin:plugin /usr/local/bin/wordpress-plugin

USER plugin:plugin
EXPOSE 8443

# ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™
ENTRYPOINT ["/usr/local/bin/wordpress-plugin"]
```

### 6. Kubernetesåˆ†é›¢é…ç½®

```yaml
# k8s-secure-deployment.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: mcp-secure
---
# Core Serverï¼ˆä¿è­·ã•ã‚ŒãŸnamespaceï¼‰
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mcp-core
  namespace: mcp-secure
spec:
  template:
    spec:
      securityContext:
        runAsNonRoot: true
        runAsUser: 65534
        fsGroup: 65534
      containers:
      - name: mcp-core
        image: mcp-core:latest
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities:
            drop: ["ALL"]
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
---
# WordPress Pluginï¼ˆéš”é›¢ã•ã‚ŒãŸnamespaceï¼‰
apiVersion: v1
kind: Namespace
metadata:
  name: mcp-plugins-wordpress
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: wordpress-plugin
  namespace: mcp-plugins-wordpress
spec:
  template:
    spec:
      securityContext:
        runAsNonRoot: true
        runAsUser: 1000
      containers:
      - name: wordpress-plugin
        image: wordpress-plugin:latest
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities:
            drop: ["ALL"]
        resources:
          requests:
            memory: "128Mi"
            cpu: "100m"
          limits:
            memory: "512Mi"    # ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹åˆ¶é™
            cpu: "200m"
---
# ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒãƒªã‚·ãƒ¼ï¼ˆé€šä¿¡åˆ¶é™ï¼‰
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: core-server-isolation
  namespace: mcp-secure
spec:
  podSelector:
    matchLabels:
      app: mcp-core
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: api-gateway
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          name: mcp-plugins-wordpress
    ports:
    - protocol: TCP
      port: 8443
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: plugin-isolation
  namespace: mcp-plugins-wordpress
spec:
  podSelector:
    matchLabels:
      app: wordpress-plugin
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: mcp-secure
  egress:
  - to: []  # å¤–éƒ¨é€šä¿¡ã¯æ˜ç¤ºçš„ã«è¨±å¯ã•ã‚ŒãŸå®›å…ˆã®ã¿
    ports:
    - protocol: TCP
      port: 443  # WordPress APIç”¨HTTPS
```

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŠ¹æœ

### 1. ç‰©ç†çš„å¢ƒç•Œã«ã‚ˆã‚‹å®Œå…¨åˆ†é›¢
- **ãƒ—ãƒ­ã‚»ã‚¹åˆ†é›¢**: å„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒç‹¬ç«‹ã—ãŸãƒ—ãƒ­ã‚»ã‚¹/ã‚³ãƒ³ãƒ†ãƒŠã§å®Ÿè¡Œ
- **ãƒ¡ãƒ¢ãƒªåˆ†é›¢**: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–“ã§ãƒ¡ãƒ¢ãƒªç©ºé–“ã‚’å…±æœ‰ã—ãªã„
- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ†é›¢**: æ˜ç¤ºçš„ã«è¨±å¯ã•ã‚ŒãŸé€šä¿¡ã®ã¿

### 2. å¤šå±¤é˜²å¾¡
- **èªè¨¼**: mTLS + JWT ã«ã‚ˆã‚‹å¼·å›ºãªèªè¨¼
- **èªå¯**: æ“ä½œãƒ¬ãƒ™ãƒ«ã§ã®ç´°ã‹ã„æ¨©é™åˆ¶å¾¡
- **ç›£æŸ»**: ã™ã¹ã¦ã®é€šä¿¡ã‚’æ”¹ã–ã‚“é˜²æ­¢ãƒ­ã‚°ã«è¨˜éŒ²
- **ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹**: ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™ã«ã‚ˆã‚‹DoSæ”»æ’ƒé˜²æ­¢

### 3. éšœå®³åˆ†é›¢
- **å˜ä¸€éšœå®³ç‚¹ã®æ’é™¤**: 1ã¤ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®éšœå®³ãŒå…¨ä½“ã«å½±éŸ¿ã—ãªã„
- **æ®µéšçš„å¾©æ—§**: éšœå®³ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã¿ã‚’åˆ‡ã‚Šé›¢ã—ã¦é‹ç”¨ç¶™ç¶š
- **ãƒ˜ãƒ«ã‚¹ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®çŠ¶æ…‹ç›£è¦–

## ğŸ“‹ å®Ÿè£…å„ªå…ˆé †ä½

### Phase 1: åŸºç›¤è¨­è¨ˆï¼ˆ2é€±é–“ï¼‰
1. ã‚»ã‚­ãƒ¥ã‚¢é€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®å®Ÿè£…
2. ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚µãƒ¼ãƒãƒ¼ã®ãƒ™ãƒ¼ã‚¹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
3. åŸºæœ¬çš„ãªã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹æ©Ÿèƒ½

### Phase 2: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ï¼ˆ2é€±é–“ï¼‰
1. mTLSèªè¨¼ã‚·ã‚¹ãƒ†ãƒ 
2. ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™ã¨ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
3. ç›£æŸ»ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ 

### Phase 3: é‹ç”¨æ©Ÿèƒ½ï¼ˆ1é€±é–“ï¼‰
1. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã¨ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
2. è¨­å®šç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
3. ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆè‡ªå‹•åŒ–

ã“ã®è¨­è¨ˆã«ã‚ˆã‚Šã€æ‚ªæ„ã®ã‚ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒæœ¬ä½“ã«ä¸ãˆã‚‹å½±éŸ¿ã‚’å®Œå…¨ã«æ’é™¤ã—ã€ä¼æ¥­ãƒ¬ãƒ™ãƒ«ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ã‚’æº€ãŸã™ã“ã¨ãŒã§ãã¾ã™ã€‚